<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="4-12-3-set-up-continuous-integration">4.12.3 Set up continuous integration</h1>
<p>This page explains how to set up a continuous integration environment for your Bonita BPM processes.</p>
<p>With Continuous Integration (CI) your processes are continuously built and tested while you are designing them. Collaborating on process design can be enhanced with CI by 
ensuring the integrity of your processes along the development phase. </p>
<p><a href="#prereq">Prerequisites</a><br><a href="#env">Set up a Bonita BPM Studio environment for CI</a><br><a href="#jenkins">Create a Jenkins job to build your processes automatically</a><br><a href="#test">Test your processes automatically</a></p>
<p>You could use any integration server, but this page describes how to use Jenkins, as an example.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>To follow this page, you need to be familiar with:</p>
<ul>
<li>Java-based project development with Maven</li>
<li>Subversion version control system use</li>
<li>Jenkins CI server installation and configuration</li>
</ul>
<p>Before you begin, you need the following components available for your CI environment:</p>
<ul>
<li>Bonita BPM Studio Teamwork, Efficiency, or Performance edition: 
The automated process build feature is not available in the Community edition.</li>
<li>A window manager: 
You need a window manager to use the Bonita BPM Studio process builder.</li>
<li>Java: 
You need Java 1.6 to be installed on the CI server and your development computer.</li>
<li>Maven:
This guide provides example Maven-based projects for executing automated tests of your processes.
Maven 3 is required on the CI server and the test development computer.</li>
<li>Subversion:
Bonita BPM Studio enables business analysts and developers to collaborate on process design using a shared Subversion (SVN) repository.
This tutorial assumes that you have access to a Subversion server.</li>
<li>Jenkins:
The <a href="http://jenkins-ci.org/">Jenkins CI</a> server is responsible for coordinating continuous build and test of your processes.
This tutorial assumes that Jenkins is up and running with Maven and Subversion plugins.</li>
</ul>
<h2 id="set-up-bonita-bpm-studio-for-ci">Set up Bonita BPM Studio for CI</h2>
<p>There are two stages to setting up Bonita BPM Studio for CI:</p>
<ol>
<li>On your Subversion server, create a shared repository that can be accessed by the business analysts and developers working on processes and by the CI tools. 
After you have create your shared repository you may develop your processes in this repository and/or import existing processes. Each Bonita BPM Studio user must connect to the repository.</li>
<li>Define an environment for configuring processes for CI. This environment will be stored in the shared repository together with your process definitions. 
The next section assumes that you created an environment called CI.</li>
</ol>
<h2 id="create-a-jenkins-job-to-build-your-processes-automatically">Create a Jenkins job to build your processes automatically</h2>
<p>This section describes how to create a Jenkins job to build your processes automatically.
This job will produce Business Archive (.bar) files ready for deployment.</p>
<p>All example scripts given on this page are compatible with Unix-like operating systems.</p>
<ol>
<li>Prepare Bonita BPM Studio on the CI server</li>
</ol>
<p>Bonita BPM Studio includes a BonitaStudioBuilder script for building processes in a CI environment. Install Bonita BPM Studio as follows:</p>
<ol>
<li><p>Download the OS-independent package (zip) from the customer portal. 
For example use BonitaBPMSubscription-6.1.0.zip for version 6.1.0. You must have the same version of Bonita BPM Studio for the shared repository and the CI server.</p>
</li>
<li><p>Extract the package to a permanent location on the CI server:
<code>$&gt; unzip -d /path/to/BonitaBPMStudio BonitaBPMSubscription-6.1.0.zip</code></p>
</li>
<li>Install your license (a license must have been requested for CI server):
<code>$&gt; cp license.lic /path/to/BonitaBPMStudio/BonitaBPMSubscription-6.1.0/lic_folder/</code></li>
</ol>
<p>You are recommended to install a window manager on the CI server in order to have process diagram screenshots generated along with business archives.</p>
<ol>
<li>Create Jenkins job</li>
</ol>
<p>In Jenkins, create a new job of type &quot;Build a free-style software project&quot;. 
Specify a job name for example &quot;BonitaBPM-BuildProcesses&quot;.</p>
<ol>
<li><p>Configure Jenkins job</p>
<ol>
<li><p>Check out your process repository from Subversion. To do this, configure the &quot;Source Code Management&quot; section to retrieve (check out) your Subversion process shared repository. 
Specify the repository URL, and optionally your local repository. We recommend that you set teh check-out strategy to <em>Use &#39;svn update&#39; as much as possible</em>.</p>
</li>
<li><p>Invoke BonitaStudioBuilder script</p>
</li>
</ol>
</li>
</ol>
<p>Note: only one instance of BonitaStudioBuilder can be executed at a time on a computer.</p>
<p>Add a build step of type &quot;Execute shell&quot; configured with the following content:</p>
<p>`</p>
<h1 id="-usr-bin-env-sh">!/usr/bin/env sh</h1>
<p>echo &quot;##### Clean previously generated business archives&quot;
rm -Rf $WORKSPACE/process-bars
echo &quot;&quot;</p>
<p>echo &quot;##### Clean BonitaStudioBuilder workspace before each execution&quot;
rm -Rf /path/to/BonitaBPMStudio/workspace
echo &quot;&quot;</p>
<p>echo &quot;##### Execute BonitaStudioBuilder for all processes&quot;
cd /path/to/BonitaBPMStudio/..
./BonitaBPMStudio/workspace_api_scripts/BonitaStudioBuilder.sh -repoPath=$WORKSPACE/process-repository -outputFolder=$WORKSPACE/process-bars -buildAll -environment=CI</p>
<p>echo &quot;##### Package generated business archives&quot;
zip $WORKSPACE/process-bars.zip $WORKSPACE/process-bars/*
`</p>
<p>This sample script invokes BonitaStudioBuilder to build all processes from your process-repository using the CI environment.</p>
<p>See the <a href="/automating-process-builds.md">BonitaStudioBuilder documentation</a> for information on script options.</p>
<ol>
<li>Share generated business archives as a Maven artifacts</li>
</ol>
<p>One way to make the generated .bar files available to other Maven projects is to install them as Maven artifacts.
The following example installs the processes artifact in the local Maven repository. </p>
<p>The Maven artifact could also be deployed to a centralized Maven repository manager solution.
To do so, add a second build step of type &quot;Invoke top-level Maven targets&quot; configured as follows:</p>
<p>`
Goals: install:install-file</p>
<p>Properties:
groupId=com.acme.bonita
artifactId=process-bars
version=1.0.0-SNAPSHOT
packaging=zip
file=$WORKSPACE/process-bars.zip
`</p>
<ol>
<li>Archive generated artifact in Jenkins</li>
</ol>
<p>You can archive the job artifact (generated processes package) in Jenkins.
To do so, add a post-build action of type &quot;Archive the artifacts&quot; and choose to archive the &quot;process-bars.zip&quot; package.
As a result, the generated business archives will be made available for download from Jenkins interface.</p>
<ul>
<li>Run the Jenkins job</li>
</ul>
<p>Run the &quot;BonitaBPM-BuildProcesses&quot; Jenkins job. When it is finished, the Maven artifact <code>com.acme.bonita:process-bars:1.0.0-SNAPSHOT</code> in installed in the local Maven repository of the CI server.
The generated processes package is also available as a job build artifact in Jenkins.</p>
<h2 id="test-your-processes-automatically">Test your processes automatically</h2>
<p>This section contains an example of how to test a process from a given Business Archive. It consists of writing JUnit Test cases using the Bonita BPM Engine Java API.</p>
<p>Note: In this example, we show only how to test the runtime aspects of a process, using the Java APIs. 
It is also possible to use cargo to deploy the generated bar file into an application server and then launch Selenium tests to test web aspects of a process.</p>
<p>For this example we are using a Maven project to write our tests.</p>
<ol>
<li>In your IDE create a new Maven project and share it (for example using SVN or Git).</li>
<li><a href="/configuring-bonita-home-client.md">Configure local access</a> to Bonita BPM Engine.</li>
<li>As we want to test processes build with a Bonita BPM Subscription edition, you need to <a href="/create-your-first-project-engine-apis-and-maven.md#maven_dependencies">configure the required Maven artifacts</a>. </li>
</ol>
<p>You should also check that there is a valid license file in <code>${bonita.home.folder}/server/licenses</code>.</p>
<ol>
<li><p>We recommend that you write your test cases in the src/test/java folder of your project and put all related resources (Bar files, organization file...) in src/test/resources.</p>
</li>
<li><p>Before installing your processes load the relevant organization (regarding your actor mapping). You may have to export your organization from a Bonita BPM Studio:
Menu Organization > Export, Select your Organization.</p>
</li>
</ol>
<p>For example:
<code>private void installOrganization(){
File organizationFile = new          File(MyTestCase.class.getResource(&quot;/ACME.xml&quot;).getFile());
String organizationContent = getFileContent(organizationFile);
getIdentityAPI().importOrganization(organizationContent);
}</code></p>
<ol>
<li>Then as a basic test, we try to deploy each generated processes. For example:</li>
</ol>
<p>`
@Test
public void deploy() throws Exception{
//Retrieve automatically generated bars as a Map
Map bars = getBars();
    Assert.assertTrue(&quot;No bar found in resources&quot;,!bars.isEmpty());</p>
<p>//For each bar deploy and enable it
for(Entry entry : bars.entrySet()){
    BusinessArchive archive = BusinessArchiveFactory.readBusinessArchive(entry.getValue()) ;
        final String entryKey = entry.getKey();
    ProcessDefinition def = getProcessAPI().deploy(archive);
        final long defId = def.getId();
        Assert.assertNotNull(&quot;Failed to deploy &quot;+entryKey,def);
        getProcessAPI().enableProcess(defId);
        getProcessAPI().disableProcess(defId);
        getProcessAPI().deleteProcessDefinition(defId);
}
}
`</p>
<p>Now configure a job to run this simple test case on your CI 
(these steps assume you have shared your generated processes as a Maven artifact, so you can use the maven-dependency plugin to retrieve the latest built processes):</p>
<ol>
<li>Create a new freestyle job in Jenkins</li>
<li><p>Configure the source code management to retrieve your Maven project.</p>
</li>
<li><p>Add a build step</p>
</li>
<li>Select &quot;Invoke top-level Maven targets&quot;</li>
<li>Use following Goal: org.apache.maven.plugins:maven-dependency-plugin:2.7:get</li>
<li>In properties, set the following:<ul>
<li>version=1.0.0-SNAPSHOT</li>
<li>dest=$WORKSPACE</li>
<li>groupId=com.acme.bonita</li>
<li>artifactId=process-bars</li>
<li>packaging=zip</li>
</ul>
</li>
</ol>
<p><img src="images/images-6_0/Get_processes.png" alt="Get the processes"></p>
<p>Get the processes</p>
<ol>
<li>Then add another build step to unzip the artifact. Select &quot;Execute shell&quot;, and use
the command <code>unzip process-bars-1.0.0-SNAPSHOT.zip -d project/src/test/resources</code>.</li>
</ol>
<p><img src="images/images-6_0/Unzip_processes.png" alt="Unzip the processes"></p>
<p>Unzip the processes</p>
<ol>
<li>Finally, add another Maven 3 build step to build the test project:<ul>
<li>Goals: clean install</li>
</ul>
</li>
</ol>
<p><img src="images/images-6_0/Invoke_Maven_Test_Project.png" alt="Build the test project"></p>
<p>Build the test project</p>
<p>You may want to publish the JUnit report:</p>
<ul>
<li>Add a post build action -> Publish Junit test result.</li>
<li>Set the path <code>project/target/test-reports/*.xml</code>.</li>
</ul>
<p><img src="images/images-6_0/Post_Build_Actions.png" alt="Publish a JUnit report"></p>
<p>Publish a JUnit report<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
