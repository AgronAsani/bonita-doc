<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="1-8-5-insert-data-in-a-docx-odt-template">1.8.5 Insert data in a .docx/.odt template</h1>
<p>The <strong>insert data in a .docx/.odt template connector</strong> allows to fill a specified template file by inserting values coming from the current process instance, for example from a form attached to a human task.</p>
<p>The template is a LibreOffice/OpenOffice <code>.odt</code> file or a Microsoft Word<code>.docx</code> file with special placeholders called <code>keys</code>.
A key is a replaceable element in the template that is identified with a dollar sign and surrounded by braces, (eg. ${element}), following the <a href="https://velocity.apache.org/engine/releases/velocity-1.7/user-guide.html">Velocity Template Language</a>.</p>
<p>To configure the connector for a task, add a connector (in or out) to the task, choose the &quot;Office&quot; category, and select &quot;insert data in a .dox/odt template&quot;. </p>
<p>In the connector configuration, the keys are mapped to variables from the process or from any other data source.
At some point in the process instance, the template file must be set as the content of a document created at pool level.
When the connector runs, it creates a file based on the template and inserts the current values of the relevant variables into the appropriate placeholders (keys) in the file.
The generated file can replace the template in the same document or be stored in another document of the process. A common usage is to send the document by email or store it in an external information system using another connector.</p>
<h2 id="how-to-insert-keys-in-a-template-file">How to insert <code>keys</code> in a template file</h2>
<h3 id="using-word-docx-tested-versions-are-microsoft-word-2007-2010-may-work-on-later-versions">Using Word (docx) - Tested versions are <strong>Microsoft Word 2007/2010</strong>, may work on later versions</h3>
<h4 id="create-a-field-">Create a <code>field</code></h4>
<ul>
<li>Insertion > QuickPart > Field...</li>
<li>Select FusionField (or MergeField in some Word versions) and use a template (see Velocity templating language) as field name (eg: ${name}, ${user.Name}...etc)</li>
<li>Click OK</li>
</ul>
<h4 id="updating-an-existing-key-">Updating an existing <code>key</code></h4>
<ul>
<li>Right click on the Fusionfield to edit</li>
<li>Click on Update field...</li>
</ul>
<h3 id="using-libreoffice-odt-">Using LibreOffice (odt)</h3>
<ul>
<li>Insert > Fields > More fields...</li>
<li>Go to Variables tab, select UserField and use a template (see Velocity templating language) as value (eg: ${name}, ${user.Name}...etc)</li>
<li>Choose Text format</li>
<li>Click Insert</li>
</ul>
<p>For further information about the template design, <a href="https://code.google.com/p/xdocreport/wiki/DesignReport">click here</a></p>
<p><strong>Warning:</strong> there is a known issue when adding an image in a .docx using drag&#39;n&#39;drop instead of a copy/paste. The image is not rendered properly if you convert the generated file into PDF.</p>
<h2 id="example-of-template-using-key-values-taken-from-a-business-variable">Example of template using key values taken from a business variable</h2>
<h3 id="business-data-model-used-in-the-example">Business Data model used in the example</h3>
<p>Here is a <a href="images/special_code/study-leave-template.docx">template example</a> for Leave Request submission and approval.  </p>
<p>This .docx file uses keys, most of which will be replaced by values from business variables created from the following <strong>Business Data Model</strong>:</p>
<p><img src="images/images-6_0/MyUser_Model_lazy.png" alt="">  </p>
<p><img src="images/images-6_0/Address_Model.png" alt="">  </p>
<p><img src="images/images-6_0/StudyLeave_Model.png" alt="">  </p>
<h3 id="connector-configuration">Connector configuration</h3>
<p>The configuration is as follows:  </p>
<p><img src="images/images-6_0/document_templating_input_mappings.png" alt=""></p>
<p>In this example, the key named <code>user</code> is mapped to the business variable <code>user</code>, the key named <code>leave</code> is mapped to the business variable <code>studyLeave</code>,
and the key named <code>today</code> is mapped to a groovy script expression with the following content:
<code>import java.text.SimpleDateFormat;
        new SimpleDateFormat(&quot;yyyy/MM/dd&quot;).format(new Date())</code></p>
<ul>
<li>If the keys are mapped with complex objects, pass the high level object to the mapping (eg. <strong>&#39;user&#39;</strong>). The connector will handle the sub-structure of this complex object (eg. <strong>${user.firstName}</strong>)</li>
<li>When using business variables, relations &quot;loaded when needed&quot; (lazy mode) are not loaded in a connector execution context. To use such relations, create new keys, like &quot;userAddress&quot; in the above example.</li>
<li>If the replacement value is null, then the field key will be rendered (eg. <strong>${userAddress.line2}</strong>). Use a &quot;!&quot; mark to render blank value, like <strong>$!{userAddress.line2}</strong> if userAddress.line2 may be null.</li>
</ul>
<p>And the output file mapping:<br><img src="images/images-6_0/document_templating_outputs.png" alt="">  </p>
<p>In this business example, the requesting user enters personal information in a process form. In a subsequent step, the reviewing user adds Approval information. The entered values are then provided as inputs to the <strong>insert data in a .docx/.odt template connector</strong> to replace the keys.
The generated output file is then stored in a document of the process.</p>
<p>This connector is built upon <strong>XdocReport</strong> third party library, for more information check their Wiki at <a href="https://github.com/opensagres/xdocreport/wiki">https://github.com/opensagres/xdocreport/wiki</a></p>
<p>You will find out advanced report design documentation:</p>
<ul>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxReportingJavaMainListFieldAdvancedTable">Loop for keys in table rows</a></li>
<li><a href="https://github.com/opensagres/xdocreport/wiki/DocxDesignReportMacro">Use a MS Word macro to design the report</a></li>
<li><a href="https://github.com/opensagres/xdocreport.samples">Report samples</a></li>
<li>...<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></li>
</ul>
