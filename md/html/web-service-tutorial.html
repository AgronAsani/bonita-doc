<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="1-8-19-2-web-service-connector-tutorial">1.8.19.2 Web service connector tutorial</h1>
<p>Note: This example uses the 6.x Application legacy forms.</p>
<p>This example process will use a Web Service connector to call a sample Web Service to display a weather report.</p>
<p><img src="images/images-6_0/webservice_diagram.png" alt="web service process diagram"></p>
<p>web service process diagram</p>
<ol>
<li>Create the diagram (as shown in the example above)</li>
<li><p>Select the Pool > Data and click on the <em><strong>Variables tab</strong></em> and add the following process variables:</p>
</li>
<li><p>city (text)</p>
</li>
<li>country (text)</li>
<li><p>weatherData (Java Object of type <code>java.util.Map</code>)</p>
<ul>
<li>Create a case start form for the Pool. Select the pool and go to the <strong>Details</strong> panel, <strong>6.x Application</strong> tab, <strong>Pageflow</strong> pane, <strong>Forms</strong> tab and add the following widgets:</li>
</ul>
</li>
<li><p>City (text field)</p>
</li>
<li>Country (text field)</li>
<li><p>Get weather forecast (submit button)</p>
<ul>
<li>Set the : <strong>transition conditions on the gateway</strong></li>
</ul>
</li>
<li><p>Select the transition to <strong>Display Weather</strong> and check Default Flow</p>
</li>
<li>Select the transition to No Result Found and edit the condition by clicking on the Pencil icon</li>
<li>Select script in the edit window and enter the following Groovy to evaluate the condition: 
<code>return (weatherData==null)</code></li>
<li><p>set a name and click OK</p>
<ul>
<li>Select the <strong>Get weather</strong> service task</li>
</ul>
</li>
<li><p>Add a WebService 1.2 connector to this task and configure it using the wizard.</p>
<ul>
<li>In the <strong>Connection parameters</strong> window:</li>
</ul>
</li>
<li><p>For the Community edition, provide these settings:</p>
<ul>
<li>Service NS: GlobalWeather</li>
<li>Service name: <a href="http://www.webserviceX.NET">http://www.webserviceX.NET</a></li>
</ul>
</li>
<li><p>For the Teamwork, Efficiency, or Performance edition. provide these settings:</p>
<ul>
<li>Enter the WDSL URL <a href="http://www.webservicex.net/globalweather.asmx?WSDL">http://www.webservicex.net/globalweather.asmx?WSDL</a> and click on the Introspect button, then leave the login info fields empty</li>
<li>Set the <code>Port: GlobalWheatherSoap12</code> and leave other parameters with default values</li>
</ul>
</li>
</ol>
<ul>
<li>In the <strong>Request parameters</strong> window (for all editions), provide these settings:</li>
</ul>
<ul>
<li>SOAP action: <a href="http://www.webserviceX.net/GetWeather">http://www.webserviceX.net/GetWeather</a></li>
<li>Port name: GlobalWeatherSoap12</li>
<li>End point address: <a href="http://www.webservicex.net/globalweather.asmx">http://www.webservicex.net/globalweather.asmx</a></li>
<li>Binding: <a href="http://www.w3.org/2003/05/soap/bindings/HTTP/">http://www.w3.org/2003/05/soap/bindings/HTTP/</a></li>
<li><p>Envelope
<code>${city}${country}</code></p>
<ul>
<li><p>In the <strong>Response configuration</strong> window, check the <strong>Returns body</strong> checkbox to use the response body in the output operations.</p>
</li>
<li><p>In the <strong>Output operations</strong> window, edit the first output operation:</p>
</li>
</ul>
</li>
<li><p>Select the weatherData variable as the connector output target</p>
</li>
<li>Click on the pencil icon to edit. Edit the expression of the data to be saved and enter the following Groovy script (the script parses the XML output of the Web Service):</li>
<li>In Expression type, click on <strong>Script</strong></li>
<li>The Script should be as follows:
`
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;</li>
</ul>
<p>import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;</p>
<p>// Clean response xml document
responseDocumentBody.normalizeDocument();
// Get result node
NodeList resultList = responseDocumentBody.getElementsByTagName(&quot;GetWeatherResult&quot;);
Element resultElement = (Element) resultList.item(0);
String weatherDataAsXML = resultElement.getTextContent();</p>
<p>// Check for empty result
if (&quot;Data Not Found&quot;.equalsIgnoreCase(weatherDataAsXML))
    return null;</p>
<p>// Parse embedded XML of result
DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
InputSource inputSource = new InputSource();
inputSource.setCharacterStream(new StringReader(weatherDataAsXML));
Document weatherDataDocument = documentBuilder.parse(inputSource);
Node weatherNode = weatherDataDocument.getDocumentElement();</p>
<p>// Save weather data
Map data = new HashMap();
NodeList childNodes = weatherNode.getChildNodes();
for (int i=0; i</p>
<ul>
<li>In <strong>Return type</strong> enter java.util.Map<ul>
<li>Select the Display weather task and add a blank form (without any widget) by going into the Application &gt; Pageflow tab</li>
</ul>
</li>
</ul>
<ul>
<li><p>In the form builder, drag and drop a table widget to create a table</p>
</li>
<li><p>Select the table widget, click on the Data tab</p>
</li>
<li><p>Click on <strong>Edit as an expression</strong>, then click on the pencil next to the first field (initial value)</p>
<ul>
<li>Use the following Script:
<code>import java.util.Map.Entry;
List&gt; table = new ArrayList&gt;();
Set&gt; weatherDataEntries = weatherData.entrySet();
for (Entry entry : weatherDataEntries)
{
List row = new ArrayList();
row.add(entry.getKey());
row.add(entry.getValue());
table.add(row);
}
return table;</code></li>
<li>In <strong>Return type</strong> enter: java.util.list</li>
</ul>
</li>
<li><p>Create a submit button called <strong>Close</strong></p>
</li>
<li><p>Select the <strong>No result found task </strong>and add a blank form by going into the Application &gt; Pageflow tab</p>
<ul>
<li><p>Add a message widget and sets its initial value to “Sorry, no result found.”</p>
</li>
<li><p>Add a submit button and name it “Close”</p>
</li>
</ul>
</li>
<li><p>Once you have finished creating the diagram and configuring the tasks, the script and form fields, click <strong>Run</strong> to deploy and run the process in Bonita BPM Portal.</p>
</li>
<li><p>In the first form, enter a country and a city e.g. France, Grenoble</p>
</li>
<li>Click <em><strong>Get Weather Forecast</strong></em></li>
<li>Click <em><strong>Display weather</strong></em></li>
</ul>
<h3 id="the-result">The Result</h3>
<p>The result is a form displaying all the weather information retrieved, for Grenoble.</p>
<p><strong>Weather forecast</strong>
Status
    Success</p>
<p>Time
    Jan 02, 2014 - 08:00 AM EST / 2014.01.02 1300 UTC</p>
<p>RelativeHumidity
    81%</p>
<p>Temperature
    51 F (11 C)</p>
<p>Location
    Grenoble / St. Geoirs, France (LFLS) 45-22N 005-20E 386M</p>
<p>DewPoint
    46 F (8 C)</p>
<p>Visibility
    greater than 7 mile(s):0</p>
<p>Pressure
    29.85 in. Hg (1011 hPa)</p>
<p>Wind
    from the SSW (200 degrees) at 8 MPH (7 KT) (direction variable):0</p>
<p>`<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
