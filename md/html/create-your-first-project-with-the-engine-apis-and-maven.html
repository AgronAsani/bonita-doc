<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="4-5-2-create-your-first-project-with-the-engine-apis-and-maven">4.5.2 Create your first project with the Engine APIs and Maven</h1>
<p>This page contains an example of to set up a Maven project to create a client that uses the Bonita BPM client APIs to communicate with the Bonita BPM Engine and run a process. 
It assumes that you are a Java programmer familiar with using Maven.</p>
<p><strong><a href="#apis">Bonita BPM Client APIs</a></strong></p>
<p><strong><a href="#maven_dependencies">Maven dependencies</a></strong></p>
<p><strong><a href="#bonita_home">Bonita home</a></strong></p>
<p><strong><a href="#login">Log in</a></strong></p>
<p><strong><a href="#java_client_example">Example of a client program</a></strong></p>
<h2 id="bonita-bpm-client-apis">Bonita BPM Client APIs</h2>
<p>In this example, we use the following APIs:</p>
<ul>
<li>LoginAPI: Manages the login on tenants. Using this API you can obtain an APISession, which is required for access to the tenant APIs, such as the IdentityAPI and the ProcessAPI.</li>
<li>ProcessAPI: Manages processes. Using this API you can handle process execution (for example, start a process, retrieve a task, execute a task, or retrieve data) and process management 
(for example, deploy, undeploy, enable or disable a process). </li>
</ul>
<h2 id="maven-dependencies">Maven dependencies</h2>
<p>In order to use the client APIs, you need to add a dependency to the <code>bonita-client</code> artifact in your Maven <code>pom.xml</code> file: </p>
<p><code>7.0.0
   ...
org.bonitasoft.enginebonita-client${bonita.bpm.version}</code></p>
<h2 id="bonita-home">Bonita home</h2>
<p>In order to execute this client example you need to set the Java system property <code>bonita.home</code>, for example <code>-Dbonita.home=</code>, 
and <a href="/configuring-bonita-home-client.md">configure a var_bonita_home for the client</a>. The bonita home used must have the same version as
the Bonita BPM Engine, which is configured in bonita.bpm.version (here 7.0.0). </p>
<h2 id="log-in">Log in</h2>
<p>The first action of the client must be to log in. This example shows how to log in when accessing the server over HTTP:</p>
<p><code>Map settings = new HashMap();
settings.put(&quot;server.url&quot;, &quot;http://localhost:8080&quot;);
settings.put(&quot;application.name&quot;, &quot;bonita&quot;);
APITypeManager.setAPITypeAndParams(ApiAccessType.HTTP, settings);
// get the LoginAPI using the TenantAPIAccessor
LoginAPI loginAPI = TenantAPIAccessor.getLoginAPI();
// log in to the tenant to create a session
APISession apiSession = loginAPI.login(username, password);</code></p>
<h2 id="example-of-a-client-program">Example of a client program</h2>
<p>In this example, a user interacts with a Bonita BPM process by choosing actions from a command-line client program written in Java.</p>
<p>The user can choose one of the following actions:</p>
<ul>
<li>start a process</li>
<li>list open process instances: process instances that have not yet completed</li>
<li>list archived process instances: process instances that have completed</li>
<li>list pending tasks</li>
<li>execute a task</li>
</ul>
<p>The program displays a menu presented by the <code>getMenutTextContent</code> method:
<code>private static String getMenutTextContent() {
   StringBuilder stb = new StringBuilder(&quot;\nChoose the action to be executed:\n&quot;);
   stb.append(&quot;0 - exit\n&quot;);
   stb.append(&quot;1 - start a process\n&quot;);
   stb.append(&quot;2 - list open process instances\n&quot;);
   stb.append(&quot;3 - list archived process instances\n&quot;);
   stb.append(&quot;4 - list pending tasks \n&quot;);
   stb.append(&quot;5 - execute a task\n&quot;);
   stb.append(&quot;Choice:&quot;);
   String message = stb.toString();
   return message;
   }</code></p>
<p>These choices are interpreted by the following code:
<code>private static void executeActions(ProcessDefinition processDefinition) 
    throws IOException, BonitaException {
    String message = getMenutTextContent();
    String choice = null;
    do {
        // show the menu and read the action chosen by the user
        choice = readLine(message);
        if (&quot;1&quot;.equals(choice)) {
            // if user chooses 1, start a new process instance
            startProcess(processDefinition);
        } else if (&quot;2&quot;.equals(choice)) {
            // if user chooses 2, list open process instances
            listOpenedProcessInstances();
        } else if (&quot;3&quot;.equals(choice)) {
            // if user chooses 3, list archived process instances
            listArchivedProcessInstances();
        } else if (&quot;4&quot;.equals(choice)) {
            // if user chooses 4, list pending tasks
            listPendingTasks();
        } else if (&quot;5&quot;.equals(choice)) {
            // if user chooses 5, execute the task chosen by the user
            executeATask();
        } else if (!&quot;0&quot;.equals(choice)) {
            System.out.println(&quot;Invalid choice!&quot;);
        }
    } while (!&quot;0&quot;.equals(choice));
}</code></p>
<h3 id="start-a-process">Start a process</h3>
<p><code>private static void startProcess(ProcessDefinition processDefinition) {
    ProcessAPI processAPI = TenantAPIAccessor.getProcessAPI(apiSession);
    ProcessInstance processInstance = processAPI.startProcess(processDefinition.getId());
}</code></p>
<h3 id="list-open-process-instances">List open process instances</h3>
<p>All Bonita BPM Engine API methods that deal with collections are paged to avoid having too many entries in memory. 
For these methods, if you want to retrieve all results you need handle this page by page. 
This the case with the searchProcessInstances method used here to retrieve open process instances. In the example, each page will contain up to 5 (PAGE_SIZE) elements:</p>
<p>`
private static void listOpenedProcessInstances() {
    // the result will be retrieved by pages of PAGE_SIZE size
    int startIndex = 0;
    int page = 1;
    SearchResult result = null;
    do {
        // get the current page of open process instances
        result = getOpenProcessInstancePage(session, startIndex);
        // print the current page
        printOpenedProcessIntancesPage(page, result);</p>
<pre><code>    // go <span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> page
    startIndex += PAGE_SIZE;
    page++;
} <span class="hljs-keyword">while</span> (result.getResult().size() == PAGE_SIZE);
</code></pre><p>}
`</p>
<p><code>private static SearchResult getOpenProcessInstancePage(APISession apiSession, int startIndex) throws BonitaException {
    // create a new SeachOptions with given start index and PAGE_SIZE as max number of elements
    SearchOptionsBuilder optionsBuilder = new SearchOptionsBuilder(startIndex, PAGE_SIZE);
    // sort the result by the process instance id in ascending order
    optionsBuilder.sort(ProcessInstanceSearchDescriptor.ID, Order.ASC);
    // perform the request and return the result
    ProcessAPI processAPI = TenantAPIAccessor.getProcessAPI(apiSession);
    return processAPI.searchProcessInstances(optionsBuilder.done());
}</code></p>
<h3 id="list-archived-process-instances">List archived process instances</h3>
<p>In order to retrieve all archived process instances you also need to iterate page by page:
`
private static void listArchivedProcessInstances() {
    // the result will be retrieved by pages of PAGE_SIZE size
    int startIndex = 0;
    int page = 1;
    SearchResult result = null;
    do {
        // get the current page of opened process instances
        result = getArchivedProcessInstancePage(session, startIndex);
        // print the current page
        printArchivedProcessInstancePage(page, result);</p>
<pre><code>    // go <span class="hljs-keyword">to</span> the <span class="hljs-keyword">next</span> page
    startIndex += PAGE_SIZE;
    page++;
} <span class="hljs-keyword">while</span> (result.getResult().size() == PAGE_SIZE);
</code></pre><p>}
`</p>
<p><code>private static SearchResult getArchivedProcessInstancePage(APISession apiSession, int startIndex) throws BonitaException {
    // create a new SeachOptions with given start index and PAGE_SIZE as max number of elements
    SearchOptionsBuilder optionsBuilder = new SearchOptionsBuilder(startIndex, PAGE_SIZE);
    // when process instances are archived the original process instance id is supplied by SOURCE_OBJECT_ID,
    // so the result will be sort by the SOURCE_OBJECT_ID
    optionsBuilder.sort(ArchivedProcessInstancesSearchDescriptor.SOURCE_OBJECT_ID, Order.ASC);
    // perform the request and return the result;
    ProcessAPI processAPI = TenantAPIAccessor.getProcessAPI(apiSession);
    return processAPI.searchArchivedProcessInstances(optionsBuilder.done());
}</code></p>
<h3 id="list-pending-tasks">List pending tasks</h3>
<p>To get the pending tasks for the logged user, you use the method getPendingHumanTaskInstances.</p>
<p>`
private static void listPendingTasks() {
    ProcessAPI processAPI = TenantAPIAccessor.getProcessAPI(apiSession);
    // the result will be retrieved by pages of PAGE_SIZE size
    int startIndex = 0;
    int page = 1;
    List pendingTasks = null;
    do {
        // get the current page
        pendingTasks = processAPI.getPendingHumanTaskInstances(session.getUserId(), startIndex, PAGE_SIZE, ActivityInstanceCriterion.LAST_UPDATE_ASC);
        // print the current page
        printTasksPage(page, pendingTasks);</p>
<pre><code>    // got <span class="hljs-keyword">to</span> <span class="hljs-keyword">next</span> page
    startIndex += PAGE_SIZE;
    page++;
} <span class="hljs-keyword">while</span> (pendingTasks.size() == PAGE_SIZE);
</code></pre><p>}
`</p>
<h3 id="execute-a-task">Execute a task</h3>
<p>Before a user can execute a task, the task needs to be assigned to the user. The assignUserTask method assigns the task to the user. The executeFlowNode method executes the task.
`
private static void executeATask() {
    processAPI.assignUserTask(taskToExecute.getId(), session.getUserId());</p>
<pre><code>processAPI<span class="hljs-preprocessor">.executeFlowNode</span>(taskToExecute<span class="hljs-preprocessor">.getId</span>())<span class="hljs-comment">;</span>
</code></pre><p>}
`<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
