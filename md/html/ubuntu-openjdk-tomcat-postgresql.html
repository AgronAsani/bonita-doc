<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="2-5-2-ubuntu-openjdk-tomcat-postgresql">2.5.2 Ubuntu + OpenJDK + Tomcat + PostgreSQL</h1>
<p>This page explains how to set up a Bonita BPM Platform in a specific environment. This environment
includes the following set of components:</p>
<ul>
<li><a href="#os">Operating System: Ubuntu Server 14.04 LTS 64 bits</a></li>
<li><a href="#jvm">Java Virtual Machine: OpenJDK 7</a></li>
<li><a href="#db">Database: PostgreSQL 9.3</a></li>
<li><a href="#jee">Application Server: Apache Tomcat 7</a></li>
<li><a href="#bonita">Bonita BPM Platform</a></li>
</ul>
<h2 id="operating-system">Operating System</h2>
<p>Simply follow a standard Ubuntu installation procedure. You won&#39;t need any specific settings here.</p>
<p>Note: make sure you got a text editor installed such as <code>nano</code>. In order to install it: <code>sudo apt-get install nano</code></p>
<p>Note: we use <code>aptitude</code> command line tool to install packages such as OpenJDK or PostgreSQL. You can also use different tool such
as <code>apt-get</code> or a graphical package manager such as <code>synaptic</code>.</p>
<h2 id="java-virtual-machine">Java Virtual Machine</h2>
<p>To install the OpenJDK JVM you need to install the <code>openjdk-7-jre-headless</code> package:</p>
<ul>
<li>Run the following command line: <code>sudo aptitude install openjdk-7-jre-headless</code></li>
<li>If needed, type your Ubuntu user password</li>
<li>Type <em><strong>Enter</strong></em> to confirm that you want to continue installation</li>
</ul>
<p>To check that Java is correctly setup in a console/terminal, type: <code>java -version</code>.
You should get a similar message to the one below:<br><code>java version &quot;1.7.0_65&quot;
OpenJDK Runtime Environment (IcedTea 2.5.3) (7u71-2.5.3-1ubuntu0.14.04.1)
OpenJDK 64-Bit Server VM (build 24.65-b04, mixed mode)</code></p>
<h2 id="database">Database</h2>
<h3 id="install">Install</h3>
<p>To install the PostgreSQL 9.3 you need to install the <code>postgres-9.3</code> package:</p>
<ul>
<li>Run the following command line: <code>sudo aptitude install postgresql-9.3</code></li>
<li>If needed, type your Ubuntu user password</li>
<li>Type <em><strong>Enter</strong></em> to confirm that you want to continue installation</li>
</ul>
<h3 id="create-databases-and-user">Create databases and user</h3>
<p>You now need to create: a new PostgreSQL user and two new databases for Bonita BPM, and grant the user the appropriate privileges to access
the databases. In a terminal or console, type following commands:</p>
<ul>
<li>Switch to a shell for <code>postgres</code> user account: <code>sudo -u postgres -i</code></li>
<li>To create a new database user named <code>bonita_db_user</code> type: <code>createuser -P bonita_db_user</code></li>
<li>Enter (twice) the password for the newly created database user. E.g.: <code>bonita_db_password</code></li>
<li>Create a new database (for Bonita BPM Engine) named <code>bonita_db</code> and give ownership to <code>bonita_db_user</code>: <code>createdb -O bonita_db_user bonita_db</code></li>
<li>Create another database (for BDM) named <code>bonita_bdm</code> and give ownership to <code>bonita_db_user</code>: <code>createdb -O bonita_db_user bonita_bdm</code></li>
<li>Exit <code>postgres</code> session, type command: <code>exit</code></li>
</ul>
<p>You can now verify that user and database are correctly created. In a terminal or console type following commands:</p>
<ul>
<li>Start PostgreSQL client program by typing: <code>psql -d bonita_db -h 127.0.0.1 -U bonita_db_user</code></li>
<li>Type the PostgreSQL user password. E.g.: bonita_db_password</li>
<li>You can run test query that should return <code>1</code>: <code>SELECT 1;</code></li>
<li>Now you can quit PostgreSQL client, type: <code>\q</code></li>
</ul>
<h3 id="enable-prepared-transactions">Enable prepared transactions</h3>
<p>Prepared transactions is disabled by default in PostgreSQL. You need to enable it:</p>
<ul>
<li>Edit the <code>postgresql.conf</code> configuration file: <code>sudo nano /etc/postgresql/9.3/main/postgresql.conf</code></li>
<li>Look for the line with <code>max_prepared_transactions</code> (line 117)</li>
<li><p>Uncomment the line: remove <code>#</code> character</p>
</li>
<li><p>Change the value from <code>zero</code> to <code>100</code></p>
</li>
<li>Save modification and quit text editor</li>
<li>Restart PostgreSQL server: <code>sudo service postgresql restart</code></li>
</ul>
<h2 id="application-server">Application Server</h2>
<h3 id="install-tomcat-7">Install Tomcat 7</h3>
<p>To install the Apache Tomcat 7 you need to install the <code>tomcat7</code> package:</p>
<ul>
<li>Run the following command line: <code>sudo aptitude install tomcat7</code></li>
<li>If needed, type your Ubuntu user password</li>
<li>Type <strong>Enter </strong> to confirm that you want to continue installation</li>
</ul>
<h3 id="add-jdbc-driver">Add JDBC driver</h3>
<p>You need to include JDBC driver in Tomcat classpath:</p>
<ul>
<li>Change to Tomcat libraries directory: <code>cd /usr/share/tomcat7/lib</code></li>
<li>Install <code>wget</code> tool in order to be able to download JDBC driver: <code>sudo aptitude install wget</code></li>
<li>Download the JDBC driver: <code>sudo wget http://jdbc.postgresql.org/download/postgresql-9.3-1102.jdbc4.jar</code></li>
</ul>
<h2 id="bonita-bpm-platform">Bonita BPM Platform</h2>
<h3 id="download-and-unzip-the-bonita-bpm-deploy-bundle">Download and unzip the Bonita BPM deploy bundle</h3>
<p>Download the Bonita BPM deploy bundle from the <a href="https://customer.bonitasoft.com/">Customer Portal</a>
(Subscription editions) or get the <a href="http://www.bonitasoft.com/how-we-do-it/downloads">Community edtion</a>. Instructions
below will be given for Bonita Subscription Pack. You can easily adapt files and folder names to your edition.</p>
<ul>
<li>Go to Bonitasoft <a href="https://customer.bonitasoft.com/">Customer Portal</a></li>
<li>In <strong>Download</strong> menu, click on <em><strong>Request a download</strong></em></li>
<li>Select your version and click on <em><strong>Access download page</strong></em> button</li>
<li>On the download page, go to the <strong>Deploying Server Components</strong> section</li>
<li><p>Click on <em><strong>Download BonitaBPMSubscription-x.y.z-deploy.zip</strong></em> link. If your server only has a terminal available
you can copy the link and use <code>wget</code> to download the file or use SSH with <code>scp</code> command to copy
the file from another computer.</p>
</li>
<li><p>Make sure that the <code>BonitaBPMSubscription-x.y.z-deploy.zip</code> is located in your home folder (e.g. <code>/home/osuser</code>).
If you type <code>cd ~ &amp;&amp; ls</code> you should see the file listed.</p>
</li>
<li><p>Make sure the <code>unzip</code> command is installed: <code>sudo aptitude install unzip</code></p>
</li>
<li>Unzip the deploy bundle: <code>unzip -q BonitaBPMSubscription-x.y.z-deploy.zip</code></li>
</ul>
<p>Finally, make sure that the user that runs the Tomcat server, is the owner of all Bonita &quot;home&quot; files:</p>
<ul>
<li>Change folders and files ownership: <code>sudo chown -R tomcat7:tomcat7 /opt/bonita</code></li>
</ul>
<h3 id="jvm-system-variables">JVM system variables</h3>
<p>To define JVM system properties, you need to use a new file named <code>setenv.sh</code>:</p>
<ul>
<li>Copy the file from deploy bundle to Tomcat <code>bin</code> folder: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/bin/setenv.sh /usr/share/tomcat7/bin/</code></li>
<li>Make the file executable: <code>sudo chmod +x /usr/share/tomcat7/bin/setenv.sh</code></li>
<li>Edit <code>setenv.sh</code> file: <code>sudo nano /usr/share/tomcat7/bin/setenv.sh</code></li>
<li>Change <code>bonita.home</code> value from <code>${CATALINA_HOME}/bonita</code> to <code>/opt/bonita/bonita_home-6.4.0</code></li>
<li>Change <code>sysprop.bonita.db.vendor</code> from <code>h2</code> to <code>postgres</code></li>
<li>Change <code>btm.root</code> from <code>${CATALINA_HOME}</code> to <code>/opt/bonita/btm</code></li>
<li>Change <code>bitronix.tm.configuration</code> from <code>${CATALINA_HOME}/conf/bitronix-config.properties</code> to <code>/opt/bonita/btm/conf/bitronix-config.properties</code></li>
</ul>
<h3 id="add-extra-libraries-to-tomcat">Add extra libraries to Tomcat</h3>
<p>Bonita needs extra libraries such as Bitronix, in order to run on Tomcat:</p>
<ul>
<li>Change to the Deploy bundle Tomcat lib folder: <code>cd ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/lib</code></li>
<li>Copy the libraries (.jar files) from the Deploy bundle to your Tomcat folder: <code>sudo cp bonita-tomcat-valve-7.0.55.jar btm-2.1.3.jar btm-tomcat55-lifecycle-2.1.3.jar jta-1.1.jar slf4j-api-1.6.1.jar slf4j-jdk14-1.6.1.jar /usr/share/tomcat7/lib/</code></li>
</ul>
<h3 id="configure-bonita-to-use-postgresql">Configure Bonita to use PostgreSQL</h3>
<p>You need to configure the data source for Bonita BPM Engine.</p>
<p>Warning: make sure you stop Tomcat before performing following operations: <code>sudo service tomcat7 stop</code></p>
<ul>
<li>Create new folders in order to store Bitronix files: <code>sudo mkdir -p /opt/bonita/btm/conf &amp;&amp; sudo mkdir /opt/bonita/btm/work</code></li>
<li>Set the ownership of the Bitronix folder: <code>sudo chown -R tomcat7:tomcat7 /opt/bonita/btm</code></li>
<li>Copy the Bitronix configuration files to <code>/opt/bonita/btm/conf</code> folder: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/conf/bitronix-* /opt/bonita/btm/conf/</code></li>
<li><p>Edit <code>bitronix-resources.properties</code> file, comment (using <code>#</code>) h2 section, uncomment PostgreSQL example
and update the username, password and DB name (&quot;bonita&quot; in the URL property) to match your configuration (e.g.
<code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_db</code>): <code>sudo nano /opt/bonita/btm/conf/bitronix-resources.properties</code></p>
</li>
<li><p>Also in <code>bitronix-resources.properties</code> update the section for <code>resource.ds2</code> (BDM data source) and set the value for the BDM data base (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_bdm</code>)</p>
</li>
<li>Save and quit: <code>CTRL+X, Y, ENTER</code></li>
<li>Copy the <code>bonita.xml</code> file (Bonita web app context configuration): <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/conf/Catalina/localhost/bonita.xml /etc/tomcat7/Catalina/localhost/</code></li>
<li><p>Edit the <code>bonita.xml</code> file by commenting the h2 datasource configuration (using ),
uncomment PostgreSQL example and update username, password and DB name (bonita in the URL property) to match your
configuration (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_db</code>): <code>sudo nano /etc/tomcat7/Catalina/localhost/bonita.xml</code></p>
</li>
<li><p>Also in <code>bonita.xml</code> file update data base configuration for BDM to match your configuration (e.g. <code>bonita_db_user</code>, <code>bonita_db_password</code> and <code>bonita_bdm</code>)</p>
</li>
<li>Save and quit: <code>CTRL+X, Y, ENTER</code></li>
<li>Copy and overwrite <code>logging.properties</code> file: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/conf/logging.properties /etc/tomcat7/logging.properties</code></li>
<li>Copy and overwrite <code>context.xml</code> file: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/conf/context.xml /etc/tomcat7/context.xml</code></li>
<li>Copy and overwrite <code>server.xml</code> file: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/conf/server.xml /etc/tomcat7/server.xml</code></li>
<li>Edit <code>server.xml</code> (<code>sudo nano /etc/tomcat7/server.xml</code>) and comment out h2 listener line</li>
<li>Fix ownership on the copied files: <code>sudo chown -R root:tomcat7 /etc/tomcat7</code></li>
</ul>
<h3 id="license">License</h3>
<p>If you run the Subscription Pack version, you will need a license:</p>
<ul>
<li><p>Generate the key in order to get a license:</p>
<ul>
<li>Change the current directory to license generation scripts folder: <code>cd ~/BonitaBPMSubscription-6.4.0-deploy/request_key_utils-6.4-006</code></li>
<li>Make the license generation script executable: <code>chmod u+x generateRequestForAnyEnvironment.sh</code></li>
<li>Run the script, type the number of CPU cores to use: <code>./generateRequestForAnyEnvironment.sh</code></li>
<li>You will get a license key number that you can copy. Make sure that you keep the brackets. If the key is separated by a linebreak, remove it and put the key on a single line.</li>
</ul>
</li>
<li><p>Connect to Bonitasoft <a href="https://customer.bonitasoft.com/">Customer Portal</a></p>
</li>
<li>Go to Licenses > <strong>Request a license</strong></li>
<li>Fill in the license request forms</li>
<li>You should receive the license file by email</li>
<li>Copy the license file to the Bonita &quot;home&quot; folder: <code>sudo cp BonitaBPMSubscription-6.1-Your_Name-ServerName-YYYYMMDD-YYYYMMDD.lic /opt/bonita/bonita_home-6.4.0/server/licenses/</code></li>
<li>Change folders and files ownership: <code>sudo chown -R tomcat7:tomcat7 /opt/bonita</code></li>
</ul>
<h3 id="deployment">Deployment</h3>
<p>Deploy the Bonita web application:</p>
<p>Copy <code>bonita.war</code> to Tomcat <code>webapps</code> folder: <code>sudo cp ~/BonitaBPMSubscription-6.4.0-deploy/Tomcat-7.0.55/webapps/bonita.war /var/lib/tomcat7/webapps/</code></p>
<p>Take care to set the proper owner: <code>sudo chown tomcat7:tomcat7 /var/lib/tomcat7/webapps/bonita.war</code></p>
<p>Start Tomcat: <code>sudo service tomcat7 start</code></p>
<h3 id="first-connection">First connection</h3>
<p>You can access the Bonita BPM Portal using your web browser, just type the following URL <code>http://:8080/bonita</code> (your_server_hostname can be either an IP address or a name).  </p>
<p>You can log in using the tenant administrator login: <code>install</code> and password: <code>install</code>.  </p>
<p>The first step is to create at least one user and add it to &quot;administrator&quot; and &quot;user&quot; profiles.<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
