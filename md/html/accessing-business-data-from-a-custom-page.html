<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="1-6-11-how-to-access-and-display-business-data-in-a-custom-page">1.6.11 How to access and display Business Data in a Custom page</h1>
<h2 id="overview">Overview</h2>
<p>This aim of this tutorial is to show how to benefit from the two technologies <strong>Custom pages</strong> and <strong>BDM</strong>.
It will describe how to display a Business Data inside a Custom page.</p>
<p><strong>Note:</strong> This information applies to custom pages created manually. 
If you <a href="/create-or-modify-page">create a page using the UI designer</a>, access business data using the <a href="/bdm-api.md">REST bdm API</a>.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>Before getting to the main part of this tutorial, you will need to carry out the following steps:</p>
<ol>
<li>Create a <a href="/business-data-model">Business Data Management model</a> in Bonita BPM Studio.</li>
<li>Export and deploy a <a href="/business-data-model">Business Data Management model</a>.</li>
<li>Define a groovy custom page. See <a href="/custom-pages.md#examples">Custom pages</a>.</li>
<li>Add a custom page to Bonita BPM Portal (as an Administrator). See <a href="/custom-profiles.md">Custom profiles</a> and <a href="/custom-pages.md">Custom pages</a>.</li>
</ol>
<h2 id="main-steps">Main steps</h2>
<p><a href="#import">Import the Business Data Model</a>
<a href="#access">Access the Business Data Management</a>
<a href="#display">Display your data</a>
<a href="#notes">Notes</a></p>
<h3 id="import-the-business-data-management">Import the Business Data Management</h3>
<p>The Custom Page needs to access the BDM through <strong>.jar files</strong> created by the Bonita BPM Studio during BDM development.</p>
<ol>
<li><p>Extract the <code>client-bdm.zip</code> file located in the following directory:
<code>engine-server/work/tenants//data-management-client</code></p>
</li>
<li><p>Copy the <code>bdm-dao.jar</code> and <code>bdm-model.jar</code> files that you extracted from the zip into the <strong>custom page directory </strong>called <strong>lib</strong>.
<code>bonita_home\client\tenants\1\work\pages\custompage_yourname\lib</code></p>
</li>
</ol>
<p>Note: A new folder containing the custom page, was automatically created when the custom page was added.</p>
<h3 id="access-the-business-data-model">Access the Business Data Model</h3>
<p>Suppose we have built a Business Data Model that represents a Leave request process, where the Bonita BPM Studio process stores information about a Leave request. </p>
<p>In the <code>Index.groovy page</code> we have to import the two java classes representing our BDM (in our example Leave request Item and Leave Request ItemDAO), together with the BusinessObjectDAOFactory that will provide us with the DAO objects
<code>import com.bonitasoft.engine.bdm.BusinessObjectDAOFactory</code>
<code>import com.leaverequest.survey.leaverequestItemDAO</code>
<code>import com.myCorp.survey.leaverequestItem</code></p>
<p>Now in the body of the custom page, its&#39;s possible to use these classes and their methods:</p>
<p>//Get the apiSession from the context
<code>def apiSession=pageContext.getApiSession();</code></p>
<p>//Create a DAO factory</p>
<p><code>def BusinessObjectDAOFactory daoFactory = new BusinessObjectDAOFactory();</code></p>
<p>//Use the factory to obtain a DAO object</p>
<p><code>def LeaveRequestDAO dao = daoFactory.createDAO(apiSession, LeaveRequestDAO.class);</code></p>
<p>//Use methods on DAO object to access data from the BDM. You can pass input values pre-calculated to the method
<code>def List leaveRequestList = dao.find(0,10);</code></p>
<h3 id="display-your-data">Display your data</h3>
<p>All the data you need to display is in string format, apart from the start and end date, that you should format. For example:
<code>DateFormat df = new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</code></p>
<p>Now that you got your Business Objects you can display them on your page.
There are many ways to do that with standard .html, depending on your needs.</p>
<p>For example you can use the method <code>out.println()</code> to print html in the page:</p>
<p>`out.println(&#39;Leave Request ListStart Date End dateLeave Type</p>
<p>&#39;);</p>
<pre><code>        for(LeaveRequest leaveRequest: leaveRequestList){         
            <span class="hljs-keyword">out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">""</span> + df<span class="hljs-preprocessor">.format</span>(leaveRequest<span class="hljs-preprocessor">.getStartDate</span>())+<span class="hljs-string">" "</span> + df<span class="hljs-preprocessor">.format</span>(leaveRequest<span class="hljs-preprocessor">.getEndDate</span>())+<span class="hljs-string">" "</span> +leaveRequest<span class="hljs-preprocessor">.getLeaveType</span>() + <span class="hljs-string">"</span>
</code></pre><p>&quot;); 
            }</p>
<pre><code>        <span class="hljs-keyword">out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">""</span>)<span class="hljs-comment">;`</span>
</code></pre><h3 id="notes">Notes</h3>
<ol>
<li>When you are developing your custom page, be aware that if you accidentally stop the Bonita BPM Studio, by default this will erase the tenant filesystem and database, so you&#39;d lose your work.</li>
</ol>
<p>A good idea is to prevent database deletion on the Bonita BPM Studio, Go to Preferences > database and uncheck clean database on exit.</p>
<ol>
<li>If the custom page is not trivial, it&#39;s often a good idea to use a groovy IDE to develop it, so it&#39;s possible to use auto completion, syntax check and colored text features.
For example if you use Eclipse, you can install the Groovy plugin.
Then create a new groovy project and point to the custom page filesystem.</li>
</ol>
<p>Additionally, you need to configure the build path adding these bonita jars:
<code>Bonita-client-sp-6.x.jar</code></p>
<p>and
<code>console-server-6.x.jar</code></p>
<p>And these data models:
<code>bdm-dao.jar</code>
<code>bdm-model.jar</code></p>
<ol>
<li>A frequent use case is to refresh the content of the page, re-submitting the queries towards the dao, via a submit button for example.</li>
</ol>
<p>To do that, one approach is to create a form with a submit button inside, as in the following examples:
<code>out.println(&quot;&quot;);</code>
<code>out.println(&quot;&quot;);</code>
<code>out.println(&quot;&quot;)</code></p>
<ol>
<li><p>The action of the form (actionUrl in the example) should point to the same url as the Custom page, i.e.
<code>http://localhost:8090/bonita/portal/homepage?tenant=1#?_p=custompage_name&amp;_pf=4)</code></p>
</li>
<li><p>By clicking on the submit button, the url will be called and the input parameters will be sent, so the next time the page will be loaded it will have this information.<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
</li>
</ol>
