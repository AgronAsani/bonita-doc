<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="4-3-2-creating-an-actor-filter">4.3.2 Creating an actor filter</h1>
<p>An actor filter is implemented in Bonita BPM in two parts, the
definition and the implementation. This enables you to change the
implementation without changing the definition. Several implementations can be
created for a single definition. See <a href="/actor-filtering">here </a>for a list of actor
filters provided with the product.</p>
<p>An actor filter is a type of connector and is created in the same way, using the same schema files as
for a connector. You can define a new actor filter definition or implementation in Bonita BPM Studio,
using the wizards started from the <strong>Development</strong> menu, <strong>Actor filters</strong> sub menu.
You can also create a new actor filter definition or implementation externally, and import it into Bonita BPM Studio.</p>
<p>This page explains how to create the actor filter definition and
implementation and import it into Bonita BPM Studio. </p>
<p><a href="#Actor_filter_definition">Actor filter definition</a><br><a href="#Actor_filter_implementation">Actor filter implementation</a><br><a href="#Testing_an_actor_filter">Testing an actor filter</a><br><a href="#Importing_an_Actor_filter">Importing an actor filter into Bonita BPM Studio</a><br><a href="#L571">Configuring and deploying a process with an actor filter
</a></p>
<h2 id="actor-filter-definition">Actor filter definition</h2>
<p>An actor filter definition controls the external interfaces of the actor
filter, both those visible to users (the actor filter configuration wizard) and
those visible to the Bonita BPM Engine (the inputs and outputs). The actor filter
definition consists of the following files:</p>
<ul>
<li>An XML file that defines the configuration wizard</li>
<li>A file containing the image that is used as an icon to represent the
actor filter</li>
<li>A properties file for each language that the wizard supports</li>
</ul>
<p>The following sections explain the elements of the definition. You can also use Bonita BPM Studio to create the definition.</p>
<h3 id="actor-filter-configuration-wizard-definition">Actor filter configuration wizard definition</h3>
<p>The XML file that defines the actor filter configuration wizard contains
definitions for header information identifying the actor filter (including the
icon), for inputs and outputs, and for the wizard pages. The definition follows
the schema defined in <a href="http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-definition-descriptor.xsd">http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-definition-descriptor.xsd</a>.
The table below lists the items in the definition.</p>
<p>Occurrence
Description</p>
<p>id
1
The identifier of the actor filter definition. Used
internally, not displayed in the wizard or in Bonita BPM Studio. Must be
unique.</p>
<p>version
1
The version of the actor filter definition. Must be
unique for the actor filter identifier.</p>
<p>icon
0 or 1
The name of a file containing the icon image.</p>
<p>category
1
The category to which the actor filter belongs. In
Bonita BPM Studio, actor filters are grouped by category. Optionally, the
category can have an icon image.</p>
<p>input
0 or more
Input data passed to the actor filter. Each input has a
unique name and a Java type. Optionally, it can be defined as
mandatory. Optionally, a default value can be set.</p>
<p>output
0 or more
Output data passed to the process from the actor filter.
Each output has a unique name and a Java type.</p>
<p>page
0 or more
A page in the wizard. A page must have a unique id. A
page consists of one or more widgets. A page is constructed by
displaying the widgets in the order in which the definitions appear in
the file.</p>
<p>widget
1 or more per page
An element within a page, corresponding to an input. A
widget must have a unique id, an input name, and a type. The following
types of widget are available: text, password, text area, check box,
radio button group, select (drop-down list), array, group, script
editor, and list.</p>
<p>jarDependency
0 or more
A dependency that must be satisfied for the wizard to
run successfully.</p>
<p>The page and widget definitions are required for an actor filter that is
used or configured from within Bonita BPM Studio. </p>
<p>The following example is the XML definition for the <em>initiator
manager</em> actor:</p>
<p><code>initiator-manager1.0.0initiator-manager.png</code></p>
<p>In this example, there is one input, a Boolean that determines whether or
not the task is automatically assigned to the user identified by the filter.
There is one page in the configuration wizard, which contains one widget.</p>
<h3 id="language-properties-file">Language properties file</h3>
<p>The text displayed in a wizard is defined separately from the
pages and widgets. This means that one actor filter definition can support
multiple languages.</p>
<p>For each language, there is a properties file that contains the category
name, the actor filter name, the actor filter definition, the name and
description of each wizard page, and the name and description of each input
widget. </p>
<p>The default language properties file is called <em>actorfilter-id_version</em>.properties,
where <em>actorfilter-id</em>
is the actor filter identifier and <em>version</em> is the actor
filter version. You can provide additional properties files to support other
languages. These files must be called <em>actorfilter-id_lang_version</em>.properties,
where <em>lang</em>
identifies the language of the properties file. The language must be supported
by Bonita BPM Studio. For example, the French properties file for the initiator
manager shown above is called initiator-manager-1.0.0_fr.properties.
When a Bonita BPM Studio user launches an actor filter configuration wizard, the
wizard is displayed in the language currently configured for Bonita BPM Studio. If
there is no properties file for this language, the default file is used. </p>
<p>The following example is the English language properties file for the
initiator manager actor filter:</p>
<p><code>process.category = Process
connectorDefinitionLabel = Initiator manager
connectorDefinitionDescription = Manager of the initiator of the process
config.pageTitle = Configuration
config.pageDescription = Configuration of the process initiator-manager filter
connexionConfigPage.pageDescription = Choose here if you want to automatically assign the task to this actor
autoAssign.label = Assign task automatically
autoAssign.description = The task will be claimed automatically by the resolved user</code></p>
<h2 id="actor-filter-implementation">Actor filter implementation</h2>
<p>An actor filter implementation consists of an XML resource file and a Java
class. You can create any number of implementations that correspond to a given definition. 
However, in a process there is a one-to-one relationship between the actor filter definition and the actor filter implementation.</p>
<h3 id="actor-filter-implementation-resource-file">Actor filter implementation resource file</h3>
<p>The resource file defines:</p>
<ul>
<li>the id and version of the definition that is implemented</li>
<li>the id and version of the implementation</li>
<li>the set of dependencies required by the implementation. </li>
</ul>
<p>The resource file follows the schema defined in <a href="http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-implementation-descriptor.xsd">http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-implementation-descriptor.xsd</a> .</p>
<p>The following example is the resource file of an implementation of the
initiator manager actor filter:</p>
<p><code>initiator-manager1.0.0org.bonitasoft.userfilter.initiator.manager.ProcessinitiatorManagerUserFilterinitiator-manager-impl1.0.0bonita-userfilter-initiator-manager-impl-1.0.0-SNAPSHOT.jar</code></p>
<h3 id="actor-filter-implementation-java-class">Actor filter implementation Java class</h3>
<p>The Java class must implement the 
org.bonitasoft.engine.filter.AbstractUserFilterclass and use the Engine
ExecutionContext. The following methods must be implemented:</p>
<ul>
<li>validateInputParameters to
check that the configuration of the actor filter is well defined</li>
<li>filter to get a list of identifiers of all the users that correspond to a
specified actor name</li>
<li>shouldAutoAssignTaskIfSingleResult
to assign the step to the user if filter returns one user</li>
</ul>
<p>For details of the APIs, the methods and related objects, see the 
<a href="/javadoc-71">Javadoc</a>.</p>
<h3 id="actor-filter-example-code">Actor filter example code</h3>
<p>The following code is an example of the initiator manager actor filter. </p>
<p>`
public class ProcessinitiatorManagerUserFilter extends AbstractUserFilter {</p>
<pre><code><span class="hljs-annotation">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">validateInputParameters</span>() <span class="hljs-keyword">throws</span> ConnectorValidationException {
}

<span class="hljs-annotation">@Override</span>
<span class="hljs-keyword">public</span> List <span class="hljs-title">filter</span>(<span class="hljs-keyword">final</span> String actorName) <span class="hljs-keyword">throws</span> UserFilterException {
    <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> processInstanceId = getExecutionContext().getParentProcessInstanceId();
          <span class="hljs-keyword">long</span> processInitiator = getAPIAccessor().getProcessAPI().getProcessInstance(processInstanceId).getStartedBy();
          <span class="hljs-keyword">return</span> Arrays.asList( getAPIAccessor().getIdentityAPI().getUser(processInitiator).getManagerUserId());
    } <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> BonitaException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UserFilterException(e);
    }
}

<span class="hljs-annotation">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">shouldAutoAssignTaskIfSingleResult</span>() {
    <span class="hljs-keyword">final</span> Boolean autoAssignO = (Boolean) getInputParameter(<span class="hljs-string">"autoAssign"</span>);
    <span class="hljs-keyword">return</span> autoAssignO == <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">true</span> : autoAssignO;
}
</code></pre><p>} 
` </p>
<h2 id="testing-an-actor-filter">Testing an actor filter</h2>
<p>There are three stages to testing an actor filter:</p>
<ol>
<li>Build the actor filter. If you are using Maven, create two projects, one
for the definition and one for the implementation. Build the artifacts for
import into Bonita BPM Studio, using the following command: </li>
</ol>
<p>mvn clean install</p>
<p>This creates a zip file.</p>
<ol>
<li>Import the actor filter into Bonita BPM Studio. From the
<strong>Development</strong> menu, choose <strong>Actor filters</strong>,
then choose <strong>Import...</strong>. Select the zip file to be
imported.</li>
<li>Test the actor filter in a process. Create a minimal process and add the actor
filter to a step. Configure the process and run it from Bonita BPM Studio.
Check the Engine log (available through the <strong>Help</strong> menu) for
any error messages caused by the actor filter.</li>
</ol>
<h2 id="importing-an-actor-filter-into-bonita-bpm-studio">Importing an actor filter into Bonita BPM Studio</h2>
<ol>
<li>Create a zip file that contains the files used by the definition and implementation.</li>
<li>In Bonita BPM Studio, go to the <strong>Development</strong> menu, <strong>Actor filters</strong>, <strong>Import actor filter...</strong>.</li>
<li>Upload the zip file.</li>
</ol>
<p>The imported actor filter is now available in the dialog for adding an actor filter.</p>
<p>It is also possible to export an actor filter using options in the <strong>Development</strong> menu. The actor is exported as a .zip file, which you can import into another
instance of Bonita BPM Studio.</p>
<h2 id="configuring-and-deploying-a-process-with-an-actor-filter">Configuring and deploying a process with an actor filter</h2>
<p>When you configure a process that uses an actor filter in Bonita BPM Studio, you
specify the definition and implementation. You must also specify any
dependencies as process dependencies. After the actor filter has been specified
in the configuration, when you build the process for deployment referencing the
configuration, the actor filter code is included in the business archive.<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
