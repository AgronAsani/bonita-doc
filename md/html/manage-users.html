<style type="text/css">/** https://gist.github.com/andyferra/2554919#file-github-css **/
body {
  font-family: Helvetica, arial, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  padding-top: 10px;
  padding-bottom: 10px;
  background-color: white;
  padding: 30px; }

body > *:first-child {
  margin-top: 0 !important; }
body > *:last-child {
  margin-bottom: 0 !important; }

a {
  color: #4183C4; }
a.absent {
  color: #cc0000; }
a.anchor {
  display: block;
  padding-left: 30px;
  margin-left: -30px;
  cursor: pointer;
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0; }

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
  cursor: text;
  position: relative; }

h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor {
  background: url("../../images/modules/styleguide/para.png") no-repeat 10px center;
  text-decoration: none; }

h1 tt, h1 code {
  font-size: inherit; }

h2 tt, h2 code {
  font-size: inherit; }

h3 tt, h3 code {
  font-size: inherit; }

h4 tt, h4 code {
  font-size: inherit; }

h5 tt, h5 code {
  font-size: inherit; }

h6 tt, h6 code {
  font-size: inherit; }

h1 {
  font-size: 28px;
  color: black; }

h2 {
  font-size: 24px;
  border-bottom: 1px solid #cccccc;
  color: black; }

h3 {
  font-size: 18px; }

h4 {
  font-size: 16px; }

h5 {
  font-size: 14px; }

h6 {
  color: #777777;
  font-size: 14px; }

p, blockquote, ul, ol, dl, li, table, pre {
  margin: 15px 0; }

hr {
  background: transparent url("../../images/modules/pulls/dirty-shade.png") repeat-x 0 0;
  border: 0 none;
  color: #cccccc;
  height: 4px;
  padding: 0; }

body > h2:first-child {
  margin-top: 0;
  padding-top: 0; }
body > h1:first-child {
  margin-top: 0;
  padding-top: 0; }
  body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child {
  margin-top: 0;
  padding-top: 0; }

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0; }

h1 p, h2 p, h3 p, h4 p, h5 p, h6 p {
  margin-top: 0; }

li p.first {
  display: inline-block; }

ul, ol {
  padding-left: 30px; }

ul :first-child, ol :first-child {
  margin-top: 0; }

ul :last-child, ol :last-child {
  margin-bottom: 0; }

dl {
  padding: 0; }
  dl dt {
    font-size: 14px;
    font-weight: bold;
    font-style: italic;
    padding: 0;
    margin: 15px 0 5px; }
    dl dt:first-child {
      padding: 0; }
    dl dt > :first-child {
      margin-top: 0; }
    dl dt > :last-child {
      margin-bottom: 0; }
  dl dd {
    margin: 0 0 15px;
    padding: 0 15px; }
    dl dd > :first-child {
      margin-top: 0; }
    dl dd > :last-child {
      margin-bottom: 0; }

blockquote {
  border-left: 4px solid #dddddd;
  padding: 0 15px;
  color: #777777; }
  blockquote > :first-child {
    margin-top: 0; }
  blockquote > :last-child {
    margin-bottom: 0; }

table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }

img {
  max-width: 100%; }

span.frame {
  display: block;
  overflow: hidden; }
  span.frame > span {
    border: 1px solid #dddddd;
    display: block;
    float: left;
    overflow: hidden;
    margin: 13px 0 0;
    padding: 7px;
    width: auto; }
  span.frame span img {
    display: block;
    float: left; }
  span.frame span span {
    clear: both;
    color: #333333;
    display: block;
    padding: 5px 0 0; }
span.align-center {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-center > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: center; }
  span.align-center span img {
    margin: 0 auto;
    text-align: center; }
span.align-right {
  display: block;
  overflow: hidden;
  clear: both; }
  span.align-right > span {
    display: block;
    overflow: hidden;
    margin: 13px 0 0;
    text-align: right; }
  span.align-right span img {
    margin: 0;
    text-align: right; }
span.float-left {
  display: block;
  margin-right: 13px;
  overflow: hidden;
  float: left; }
  span.float-left span {
    margin: 13px 0 0; }
span.float-right {
  display: block;
  margin-left: 13px;
  overflow: hidden;
  float: right; }
  span.float-right > span {
    display: block;
    overflow: hidden;
    margin: 13px auto 0;
    text-align: right; }

code, tt {
  margin: 0 2px;
  padding: 0 5px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  border-radius: 3px; }

pre code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent; }

pre {
  background-color: #073642;
  color: #f8f8f8;
  border: 1px solid #cccccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px; }
  pre code, pre tt {
    background-color: transparent;
    border: none; }

</style><link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/solarized_dark.min.css">
<h1 id="4-5-5-4-manage-users">4.5.5.4 Manage users</h1>
<p>In this page:</p>
<p><a href="#create">Create a new user</a><br><a href="#add_to_group">Add a user to a group</a><br><a href="#List_in_group">List the users in a group</a><br><a href="#list_with_rile_in_group">List the users with a specified role in a group</a><br><a href="#get_contact">Get user contact data</a><br><a href="#search">Search for users</a><br><a href="#get_pending">Get the pending tasks for a user</a><br><a href="#get_eligible">Get possible users of a task and execute task for a user</a></p>
<h2 id="create-a-new-user">Create a new user</h2>
<p>This example shows you how to create a new user and assign the user to a profile. </p>
<p><strong>Create a new user</strong> by calling the createUser method:
<code>// create new user, with username john and password bpm
final User user = identityAPI.createUser(&quot;john&quot;, &quot;bpm&quot;);
System.out.println(&quot;New user created: &quot; + user);</code></p>
<p>Alternatively, you can create a more complex user object as follows:
<code>// create complex user 
UserCreator creator = new UserCreator(&quot;john&quot;, &quot;bpm&quot;);
creator.setFirstName(&quot;Johnny&quot;).setLastName(&quot;B. Good&quot;);
ContactDataCreator proContactDataCreator = new ContactDataCreator().setAddress(&quot;32 rue 
        Gustave Eiffel&quot;).setCity(&quot;Grenoble&quot;).setPhoneNumber(&quot;555 14 12 541&quot;);
creator.setProfessionalContactData(proContactDataCreator);
final User user2 = identityAPI.createUser(creator);</code></p>
<p>Now add the user to a Bonita BPM Portal profile. A user who does not have a profile cannot log in to Bonita BPM Portal.
`
// reference the user in the profile User
// the user must be now registered in one profile. Let&#39;s choose the profile user
org.bonitasoft.engine.api.ProfileAPI orgProfileAPI = apiAccessor.getProfileAPI();
SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0,10);
searchOptionsBuilder.filter(ProfileSearchDescriptor.NAME, &quot;user&quot;);
SearchResult searchResultProfile = orgProfileAPI.searchProfiles(searchOptionsBuilder.done());</p>
<p>// we should find one result now
if (searchResultProfile.getResult().size()!=1)
        { return; }</p>
<p>// now register the user in the profile
Profile profile = searchResultProfile.getResult().get(0);
ProfileMemberCreator profileMemberCreator = new ProfileMemberCreator( profile.getId());
profileMemberCreator.setUserId( user.getId());
orgProfileAPI.createProfileMember(profileMemberCreator);
`</p>
<p>To create a user with more complete information, use the UserBuilder to create 
an instance of User and then use the createUser method with the User as parameter.</p>
<h2 id="add-a-user-to-a-group">Add a user to a group</h2>
<p>This example shows how to add a user to a group.</p>
<p>The user, group, and role are already defined, and each one is specified by ID.
Note that it is not possible to add a user without a role.</p>
<p><code>final IdentityAPI identityAPI = new IdentityAccessor().getIdentityAPI(apiSession);
UserMembership membership = identityAPI.addUserMembership(userId, groupId, roleId);</code></p>
<h2 id="list-the-users-in-a-group">List the users in a group</h2>
<p>This example shows how to get a list of users in a specified group in the organization.</p>
<p>The group is specified by groupID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>
<p><code>final IdentityAPI identityAPI = TenantAPIAccessor.getIdentityAPI(apiSession);
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100);
builder.filter(UserSearchDescriptor.GROUP_ID, groupID);
final SearchResult userResults = identityAPI(apiSession).searchUsers(builder.done());</code></p>
<h2 id="list-the-users-with-a-specified-role-in-a-group">List the users with a specified role in a group</h2>
<p>This example shows how to get a list of the users who have the specified role in the specified group in the organization.</p>
<p>The group is specified by groupID. The role is specified by roleID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>
<p><code>final IdentityAPI identityAPI = TenantAPIAccessor.getIdentityAPI(apiSession);
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100);
builder.filter(UserSearchDescriptor.GROUP_ID, groupID);
builder.filter(UserSearchDescriptor.ROLE_ID, roleID);
final SearchResult userResults = identityAPI(apiSession).searchUsers(builder.done());</code></p>
<h2 id="get-user-contact-data">Get user contact data</h2>
<p>You can use the <code>getUserWithProfessionalDetails</code> method to retrieve a user and their professional contact data for a user.</p>
<p>This example shows how to get a user and the email address.</p>
<p><code>// Get the professional email address of a user
UserWithContactData proUser = getIdentityAPI().getUserWithProfessionalDetails(user.getId());
proUser.getContactData().getEmail();</code></p>
<h2 id="search-for-users">Search for users</h2>
<p>The following example is a client application that accesses the Engine in HTTP mode to search for 20 users and display their names and identifiers. </p>
<p>`
package org.bonitasoft.example;</p>
<p>import org.bonitasoft.engine.api.IdentityAPI;
import org.bonitasoft.engine.api.LoginAPI;
import org.bonitasoft.engine.api.TenantAPIAccessor;
import org.bonitasoft.engine.identity.User;
import org.bonitasoft.engine.search.SearchOptionsBuilder;
import org.bonitasoft.engine.search.SearchResult;
import org.bonitasoft.engine.session.APISession;</p>
<p>public class BonitaClientApplicationExample {</p>
<pre><code>public static void main(final String[] args) throws Exception {


    // example code:
    final LoginAPI loginAPI = TenantAPIAccessor<span class="hljs-preprocessor">.getLoginAPI</span>()<span class="hljs-comment">;</span>
    System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"login with install//install"</span>)<span class="hljs-comment">;</span>
    final APISession session = loginAPI<span class="hljs-preprocessor">.login</span>(<span class="hljs-string">"install"</span>, <span class="hljs-string">"install"</span>)<span class="hljs-comment">;</span>
    final IdentityAPI identityAPI = TenantAPIAccessor<span class="hljs-preprocessor">.getIdentityAPI</span>(session)<span class="hljs-comment">;</span>
    final SearchResult searchUsers = identityAPI<span class="hljs-preprocessor">.searchUsers</span>(new SearchOptionsBuilder(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>)<span class="hljs-preprocessor">.done</span>())<span class="hljs-comment">;</span>
    System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"20 first users:"</span>)<span class="hljs-comment">;</span>
    for (final User user : searchUsers<span class="hljs-preprocessor">.getResult</span>()) {
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">" * "</span> + user<span class="hljs-preprocessor">.getUserName</span>() + <span class="hljs-string">" -- "</span> + user<span class="hljs-preprocessor">.getId</span>())<span class="hljs-comment">;</span>
    }
    loginAPI<span class="hljs-preprocessor">.logout</span>(session)<span class="hljs-comment">;</span>
    System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"logged out"</span>)<span class="hljs-comment">;</span>
}
</code></pre><p>}
`</p>
<h2 id="get-the-pending-tasks-for-a-user">Get the pending tasks for a user</h2>
<p>This example shows you how use the Bonita BPM Engine API to get the pending tasks for a user.</p>
<p>It shows how to get the list of pending tasks, and then for each task, how to assign it to the user and execute it.</p>
<p>To <strong>get the pending tasks</strong> for a given user, call the getPendingHumanTaskInstances method.
In this example, the first page of the current logged user&#39;s tasks are retrieved ordered by priority. 
Each page contains up to 20 tasks.
<code>// get the pending tasks for the current logged in user
final List pendingTasks = 
       processAPI.getPendingHumanTaskInstances(session.getUserId(), 
           0, 20, ActivityInstanceCriterion.PRIORITY_ASC);
System.out.println(&quot;Pending tasks for user &quot; + session.getUserName() + &quot;: &quot; + pendingTasks);</code></p>
<p>Note that this does not return tasks that are already assigned to the user.</p>
<p>Then loop through the list of tasks. For each task, <strong>assign the task</strong> to the user and <strong>execute the task</strong>:
<code>// assign and execute pending tasks
for (final HumanTaskInstance pendingTask : pendingTasks) {
    // assign the task to the user
    processAPI.assignUserTask(pendingTask.getId(), session.getUserId());
    // execute the task
    processAPI.executeFlowNode(pendingTask.getId());
}</code></p>
<h2 id="get-possible-users-of-a-task-and-execute-task-for-a-user">Get possible users of a task and execute task for a user</h2>
<p>This example shows how to get the list of users who are eligible to perform a task.</p>
<p>First, it creates a simple process containing one human task, called &quot;step1&quot;. 
This task will be performed by a user who is mapped to the &quot;expert&quot; actor. An actor filter is applied to &quot;step1&quot;, assigning the task specifically to the superExpert user.</p>
<p>Next, it calls <code>getPossibleUsersOfHumanTask</code> to get the list of all users who are eligible to perform the step1 according to the process definition. 
This will be a list of all the users who are mapped to the expert actor.</p>
<p>Next, it calls <code>getPossibleUsersOfPendingHumanTask</code> to get the list of users who will perform a specific instance of step1, in the process instance. 
The actor filter is applied when the task instance is created. This is known as <strong>dynamic task assignment</strong>. 
The actor filter is applied and a shorter list of users is returned (in this case, just superExpert).</p>
<p>Dynamic task assignment using <code>getPossibleUsersOfPendingHumanTask</code> re-evaluates the actor mapping including any actor filters. 
It is useful if your organization changes after a process instance is started and you need to modify the list of users who can perform a task.</p>
<p>Finally, it executes the task for the fist user on the list. This &quot;execute for&quot; feature is not available in the Community and Teamwork editions.</p>
<p>`
// Create a process definition containing a human task, step1
// Step1 is performed by actor expert adjusted by an actor filter</p>
<p>final ProcessDefinitionBuilder designProcessDefinition = new ProcessDefinitionBuilder().createNewInstance(&quot;assign&quot;, &quot;5.0&quot;);
designProcessDefinition.addActor(&quot;expert&quot;);
final UserTaskDefinitionBuilder taskDefinitionBuilder = designProcessDefinition.addUserTask(&quot;step1&quot;, &quot;expert&quot;);</p>
<pre><code>    taskDefinitionBuilder<span class="hljs-preprocessor">.addUserFilter</span>(<span class="hljs-string">"test"</span>, <span class="hljs-string">"org.bonitasoft.engine.filter.user.testFilter"</span>, <span class="hljs-string">"1.0"</span>)<span class="hljs-preprocessor">.addInput</span>(<span class="hljs-string">"userId"</span>,
            new ExpressionBuilder()<span class="hljs-preprocessor">.createConstantLongExpression</span>(superExpert<span class="hljs-preprocessor">.getId</span>()))<span class="hljs-comment">;</span>
</code></pre><p>final ProcessDefinition processDefinition = deployAndEnableWithActor(designProcessDefinition.done(), &quot;expert&quot;, role);</p>
<p>final ProcessInstance processInstance = getProcessAPI().startProcess(processDefinition.getId());
Thread.sleep(3000);
final SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0, 1);
searchOptionsBuilder.filter(HumanTaskInstanceSearchDescriptor.NAME, &quot;step1&quot;);
final HumanTaskInstance userTask = getProcessAPI().searchHumanTaskInstances(searchOptionsBuilder.done()).getResult().get(0);</p>
<p>// Get all users of the actor of the userTask called &#39;step1&#39;
List possibleUsers = getProcessAPI().getPossibleUsersOfHumanTask(processDefinition.getId(), &quot;step1&quot;, 0, 10);</p>
<p>// Get the filtered list of users for the task instance</p>
<p>possibleUsers = getProcessAPI().getPossibleUsersOfPendingHumanTask(userTask.getId(), 0, 10);</p>
<p>// Execute task for first user in list
processAPI.assignUserTask(activityId, possibleUsers.get(0).getId());
processAPI.executeFlowNode(possibleUsers.get(0).getId(), activityId);</p>
<p>`<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></p>
