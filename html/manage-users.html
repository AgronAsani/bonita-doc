<?xml encoding="UTF-8"><html lang="en-US"><head><meta charset="UTF-8"><title>Manage users</title></head><body class="front">
		<div id="content">
	<h1>4.5.5.4 Manage users</h1>
    <p>In this page:</p>

<p>
<a href="#create">Create a new user</a><br><a href="#add_to_group">Add a user to a group</a><br><a href="#List_in_group">List the users in a group</a><br><a href="#list_with_rile_in_group">List the users with a specified role in a group</a><br><a href="#get_contact">Get user contact data</a><br><a href="#search">Search for users</a><br><a href="#get_pending">Get the pending tasks for a user</a><br><a href="#get_eligible">Get possible users of a task and execute task for a user</a></p>

<h2 id="create">Create a new user</h2>

<p><a id="top"></a>This example shows you how to create a new user and assign the user to a profile. 
</p>

<p><strong>Create a new user</strong> by calling the <span class="tt">createUser</span> method:</p>
<code type="java">
// create new user, with username john and password bpm
final User user = identityAPI.createUser(&quot;john&quot;, &quot;bpm&quot;);
System.out.println(&quot;New user created: &quot; + user);
</code>

<p>Alternatively, you can create a more complex user object as follows:</p>
<code type="java">
// create complex user 
UserCreator creator = new UserCreator(&quot;john&quot;, &quot;bpm&quot;);
creator.setFirstName(&quot;Johnny&quot;).setLastName(&quot;B. Good&quot;);
ContactDataCreator proContactDataCreator = new ContactDataCreator().setAddress(&quot;32 rue 
        Gustave Eiffel&quot;).setCity(&quot;Grenoble&quot;).setPhoneNumber(&quot;555 14 12 541&quot;);
creator.setProfessionalContactData(proContactDataCreator);
final User user2 = identityAPI.createUser(creator);
</code>

<p>Now add the user to a Bonita BPM Portal profile. A user who does not have a profile cannot log in to Bonita BPM Portal.</p>
<code type="java">
// reference the user in the profile User
// the user must be now registered in one profile. Let&apos;s choose the profile user
org.bonitasoft.engine.api.ProfileAPI orgProfileAPI = apiAccessor.getProfileAPI();
SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0,10);
searchOptionsBuilder.filter(ProfileSearchDescriptor.NAME, &quot;user&quot;);
SearchResult<profile> searchResultProfile = orgProfileAPI.searchProfiles(searchOptionsBuilder.done());
    
// we should find one result now
if (searchResultProfile.getResult().size()!=1)
        { return; }

// now register the user in the profile
Profile profile = searchResultProfile.getResult().get(0);
ProfileMemberCreator profileMemberCreator = new ProfileMemberCreator( profile.getId());
profileMemberCreator.setUserId( user.getId());
orgProfileAPI.createProfileMember(profileMemberCreator);
</profile></code>


<p>To create a user with more complete information, use the <span class="tt">UserBuilder</span> to create 
an instance of <span class="tt">User</span> and then use the <span class="tt">createUser</span> method with the <span class="tt">User</span> as parameter.</p>

<h2 id="add_to_group">Add a user to a group</h2>

<p>This example shows how to add a user to a group.</p>

<p>The user, group, and role are already defined, and each one is specified by ID.
Note that it is not possible to add a user without a role.</p>

<code type="java">
final IdentityAPI identityAPI = new IdentityAccessor().getIdentityAPI(apiSession);
UserMembership membership = identityAPI.addUserMembership(userId, groupId, roleId);
</code>

<h2 id="List_in_group">List the users in a group</h2>

<p>This example shows how to get a list of users in a specified group in the organization.</p>

<p>The group is specified by groupID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>

<code type="java">
final IdentityAPI identityAPI = TenantAPIAccessor.getIdentityAPI(apiSession);
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100);
builder.filter(UserSearchDescriptor.GROUP_ID, groupID);
final SearchResult<user> userResults = identityAPI(apiSession).searchUsers(builder.done());
</user></code>

<h2 id="list_with_rile_in_group">List the users with a specified role in a group</h2>

<p>This example shows how to get a list of the users who have the specified role in the specified group in the organization.</p>

<p>The group is specified by groupID. The role is specified by roleID. The search options specify that a maximum of 100 items are listed, starting with the first one.</p>

<code type="java">
final IdentityAPI identityAPI = TenantAPIAccessor.getIdentityAPI(apiSession);
final SearchOptionsBuilder builder = new SearchOptionsBuilder(0, 100);
builder.filter(UserSearchDescriptor.GROUP_ID, groupID);
builder.filter(UserSearchDescriptor.ROLE_ID, roleID);
final SearchResult<user> userResults = identityAPI(apiSession).searchUsers(builder.done());
</user></code>

<h2 id="get_contact">Get user contact data</h2>

<p>You can use the <code>getUserWithProfessionalDetails</code> method to retrieve a user and their professional contact data for a user.</p>

<p>This example shows how to get a user and the email address.</p>

<code type="java">
// Get the professional email address of a user
UserWithContactData proUser = getIdentityAPI().getUserWithProfessionalDetails(user.getId());
proUser.getContactData().getEmail();
</code>

<h2 id="search">Search for users</h2>

<p>The following example is a client application that accesses the Engine in HTTP mode to search for 20 users and display their names and identifiers. </p>

<code type="java">
package org.bonitasoft.example;

import org.bonitasoft.engine.api.IdentityAPI;
import org.bonitasoft.engine.api.LoginAPI;
import org.bonitasoft.engine.api.TenantAPIAccessor;
import org.bonitasoft.engine.identity.User;
import org.bonitasoft.engine.search.SearchOptionsBuilder;
import org.bonitasoft.engine.search.SearchResult;
import org.bonitasoft.engine.session.APISession;

public class BonitaClientApplicationExample {

    public static void main(final String[] args) throws Exception {


        // example code:
        final LoginAPI loginAPI = TenantAPIAccessor.getLoginAPI();
        System.out.println(&quot;login with install//install&quot;);
        final APISession session = loginAPI.login(&quot;install&quot;, &quot;install&quot;);
        final IdentityAPI identityAPI = TenantAPIAccessor.getIdentityAPI(session);
        final SearchResult<user> searchUsers = identityAPI.searchUsers(new SearchOptionsBuilder(0, 20).done());
        System.out.println(&quot;20 first users:&quot;);
        for (final User user : searchUsers.getResult()) {
            System.out.println(&quot; * &quot; + user.getUserName() + &quot; -- &quot; + user.getId());
        }
        loginAPI.logout(session);
        System.out.println(&quot;logged out&quot;);
    }
}
</user></code>

<h2 id="get_pending">Get the pending tasks for a user</h2>

<p><a id="top"></a>This example shows you how use the Bonita BPM Engine API to get the pending tasks for a user.</p>
<p>It shows how to get the list of pending tasks, and then for each task, how to assign it to the user and execute it.</p>


<p>To <strong>get the pending tasks</strong> for a given user, call the <span class="tt">getPendingHumanTaskInstances</span> method.
In this example, the first page of the current logged user&apos;s tasks are retrieved ordered by priority. 
Each page contains up to 20 tasks.</p>
<code type="java">
// get the pending tasks for the current logged in user
final List<humantaskinstance> pendingTasks = 
       processAPI.getPendingHumanTaskInstances(session.getUserId(), 
           0, 20, ActivityInstanceCriterion.PRIORITY_ASC);
System.out.println(&quot;Pending tasks for user &quot; + session.getUserName() + &quot;: &quot; + pendingTasks);
</humantaskinstance></code>

<p>Note that this does not return tasks that are already assigned to the user.</p>

<p>Then loop through the list of tasks. For each task, <strong>assign the task</strong> to the user and <strong>execute the task</strong>:</p>
<code type="java">
// assign and execute pending tasks
for (final HumanTaskInstance pendingTask : pendingTasks) {
    // assign the task to the user
    processAPI.assignUserTask(pendingTask.getId(), session.getUserId());
    // execute the task
    processAPI.executeFlowNode(pendingTask.getId());
}
</code>

<h2 id="get_eligible">Get possible users of a task and execute task for a user</h2>

<p>This example shows how to get the list of users who are eligible to perform a task.</p>

<p>First, it creates a simple process containing one human task, called &quot;step1&quot;. 
This task will be performed by a user who is mapped to the &quot;expert&quot; actor. An actor filter is applied to &quot;step1&quot;, assigning the task specifically to the superExpert user.</p>

<p>Next, it calls <code>getPossibleUsersOfHumanTask</code> to get the list of all users who are eligible to perform the step1 according to the process definition. 
This will be a list of all the users who are mapped to the expert actor.</p>

<p>Next, it calls <code>getPossibleUsersOfPendingHumanTask</code> to get the list of users who will perform a specific instance of step1, in the process instance. 
The actor filter is applied when the task instance is created. This is known as <strong>dynamic task assignment</strong>. 
The actor filter is applied and a shorter list of users is returned (in this case, just superExpert).</p>

<p>Dynamic task assignment using <code>getPossibleUsersOfPendingHumanTask</code> re-evaluates the actor mapping including any actor filters. 
It is useful if your organization changes after a process instance is started and you need to modify the list of users who can perform a task.</p>

<p>Finally, it executes the task for the fist user on the list. This &quot;execute for&quot; feature is not available in the Community and Teamwork editions.</p>

<code type="java">
// Create a process definition containing a human task, step1
// Step1 is performed by actor expert adjusted by an actor filter


final ProcessDefinitionBuilder designProcessDefinition = new ProcessDefinitionBuilder().createNewInstance(&quot;assign&quot;, &quot;5.0&quot;);
designProcessDefinition.addActor(&quot;expert&quot;);
final UserTaskDefinitionBuilder taskDefinitionBuilder = designProcessDefinition.addUserTask(&quot;step1&quot;, &quot;expert&quot;);

        taskDefinitionBuilder.addUserFilter(&quot;test&quot;, &quot;org.bonitasoft.engine.filter.user.testFilter&quot;, &quot;1.0&quot;).addInput(&quot;userId&quot;,
                new ExpressionBuilder().createConstantLongExpression(superExpert.getId()));

final ProcessDefinition processDefinition = deployAndEnableWithActor(designProcessDefinition.done(), &quot;expert&quot;, role);

final ProcessInstance processInstance = getProcessAPI().startProcess(processDefinition.getId());
Thread.sleep(3000);
final SearchOptionsBuilder searchOptionsBuilder = new SearchOptionsBuilder(0, 1);
searchOptionsBuilder.filter(HumanTaskInstanceSearchDescriptor.NAME, &quot;step1&quot;);
final HumanTaskInstance userTask = getProcessAPI().searchHumanTaskInstances(searchOptionsBuilder.done()).getResult().get(0);

// Get all users of the actor of the userTask called &apos;step1&apos;
List<user> possibleUsers = getProcessAPI().getPossibleUsersOfHumanTask(processDefinition.getId(), &quot;step1&quot;, 0, 10);


// Get the filtered list of users for the task instance

possibleUsers = getProcessAPI().getPossibleUsersOfPendingHumanTask(userTask.getId(), 0, 10);

// Execute task for first user in list
processAPI.assignUserTask(activityId, possibleUsers.get(0).getId());
processAPI.executeFlowNode(possibleUsers.get(0).getId(), activityId);

</user></code>

</div>
	</body></html>
