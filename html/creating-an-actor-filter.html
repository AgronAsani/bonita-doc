<?xml encoding="UTF-8"><html lang="en-US"><head><meta charset="UTF-8"><title>Creating an actor filter</title></head><body class="front">
		<div id="content">
	<h1>4.3.2 Creating an actor filter</h1>
    <a id="top"></a><p>An actor filter is implemented in Bonita BPM in two parts, the
definition and the implementation. This enables you to change the
implementation without changing the definition. Several implementations can be
created for a single definition. See <a href="/actor-filtering">here </a>for a list of actor
filters provided with the product.</p>

<p>An actor filter is a type of connector and is created in the same way, using the same schema files as
for a connector. You can define a new actor filter definition or implementation in Bonita BPM Studio,
using the wizards started from the <strong>Development</strong> menu, <strong>Actor filters</strong> sub menu.
You can also create a new actor filter definition or implementation externally, and import it into Bonita BPM Studio.</p>

<p>This page explains how to create the actor filter definition and
implementation and import it into Bonita BPM Studio. </p>

<p><a href="#Actor_filter_definition">Actor filter definition</a><br><a href="#Actor_filter_implementation">Actor filter implementation</a><br><a href="#Testing_an_actor_filter">Testing an actor filter</a><br><a href="#Importing_an_Actor_filter">Importing an actor filter into Bonita BPM Studio</a><br><a href="#L571">Configuring and deploying a process with an actor filter
</a></p>

<p></p>

<h2><a id="Actor_filter_definition"></a>Actor filter definition</h2>

<p>An actor filter definition controls the external interfaces of the actor
filter, both those visible to users (the actor filter configuration wizard) and
those visible to the Bonita BPM Engine (the inputs and outputs). The actor filter
definition consists of the following files:</p>
<ul><li>An XML file that defines the configuration wizard</li>
  <li>A file containing the image that is used as an icon to represent the
    actor filter</li>
  <li>A properties file for each language that the wizard supports</li>
</ul><p>The following sections explain the elements of the definition. You can also use Bonita BPM Studio to create the definition.</p>

<h3>Actor filter configuration wizard definition</h3>

<p>The XML file that defines the actor filter configuration wizard contains
definitions for header information identifying the actor filter (including the
icon), for inputs and outputs, and for the wizard pages. The definition follows
the schema defined in <span class="tt">http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-definition-descriptor.xsd</span>.
The table below lists the items in the definition.</p>


<table border="1" cellpadding="2" cellspacing="2" width="100%"><tbody><tr><th valign="top"></th>
      <th valign="top">Occurrence</th>
      <th valign="top">Description</th>
    </tr><tr><td valign="top">id</td>
      <td valign="top">1</td>
      <td valign="top">The identifier of the actor filter definition. Used
        internally, not displayed in the wizard or in Bonita BPM Studio. Must be
        unique.</td>
    </tr><tr><td valign="top">version</td>
      <td valign="top">1</td>
      <td valign="top">The version of the actor filter definition. Must be
        unique for the actor filter identifier.</td>
    </tr><tr><td valign="top">icon</td>
      <td valign="top">0 or 1</td>
      <td valign="top">The name of a file containing the icon image.</td>
    </tr><tr><td valign="top">category</td>
      <td valign="top">1</td>
      <td valign="top">The category to which the actor filter belongs. In
        Bonita BPM Studio, actor filters are grouped by category. Optionally, the
        category can have an icon image.</td>
    </tr><tr><td valign="top">input</td>
      <td valign="top">0 or more</td>
      <td valign="top">Input data passed to the actor filter. Each input has a
        unique name and a Java type. Optionally, it can be defined as
        mandatory. Optionally, a default value can be set.</td>
    </tr><tr><td valign="top">output</td>
      <td valign="top">0 or more</td>
      <td valign="top">Output data passed to the process from the actor filter.
        Each output has a unique name and a Java type.</td>
    </tr><tr><td valign="top">page</td>
      <td valign="top">0 or more</td>
      <td valign="top">A page in the wizard. A page must have a unique id. A
        page consists of one or more widgets. A page is constructed by
        displaying the widgets in the order in which the definitions appear in
        the file.</td>
    </tr><tr><td valign="top">widget</td>
      <td valign="top">1 or more per page</td>
      <td valign="top">An element within a page, corresponding to an input. A
        widget must have a unique id, an input name, and a type. The following
        types of widget are available: text, password, text area, check box,
        radio button group, select (drop-down list), array, group, script
        editor, and list.</td>
    </tr><tr><td valign="top">jarDependency</td>
      <td valign="top">0 or more</td>
      <td valign="top">A dependency that must be satisfied for the wizard to
        run successfully.</td>
    </tr></tbody></table><p>The page and widget definitions are required for an actor filter that is
used or configured from within Bonita BPM Studio. </p>

<p>The following example is the XML definition for the <em>initiator
manager</em> actor:</p>

<code type="xml">
<?xml version="1.0" encoding="UTF-8"?><connectordefinition xmlns:definition="http://www.bonitasoft.org/ns/connector/definition/6.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><id>initiator-manager</id><version>1.0.0</version><icon>initiator-manager.png</icon><category id="process" icon="process.gif"></category><input name="autoAssign" type="java.lang.Boolean" mandatory="false" defaultvalue="true"><page id="config"><widget id="autoAssign" inputname="autoAssign" xsi:type="definition:Checkbox"></widget></page></connectordefinition></code>

<p>In this example, there is one input, a Boolean that determines whether or
not the task is automatically assigned to the user identified by the filter.
There is one page in the configuration wizard, which contains one widget.</p>

<h3>Language properties file</h3>

<p>The text displayed in a wizard is defined separately from the
pages and widgets. This means that one actor filter definition can support
multiple languages.</p>

<p>For each language, there is a properties file that contains the category
name, the actor filter name, the actor filter definition, the name and
description of each wizard page, and the name and description of each input
widget. </p>

<p>The default language properties file is called <span class="tt"><i>actorfilter-id_version</i>.properties</span>,
where <span class="tt"><i>actorfilter-id</i></span>
is the actor filter identifier and <span class="tt"><i>version</i></span> is the actor
filter version. You can provide additional properties files to support other
languages. These files must be called <span class="tt"><i>actorfilter-id_lang_version</i>.properties</span>,
where <span class="tt"><i>lang</i></span>
identifies the language of the properties file. The language must be supported
by Bonita BPM Studio. For example, the French properties file for the initiator
manager shown above is called <span class="tt">initiator-manager-1.0.0_fr.properties</span>.
When a Bonita BPM Studio user launches an actor filter configuration wizard, the
wizard is displayed in the language currently configured for Bonita BPM Studio. If
there is no properties file for this language, the default file is used. </p>

<p>The following example is the English language properties file for the
initiator manager actor filter:</p>

<code type="xml">
process.category = Process
connectorDefinitionLabel = Initiator manager
connectorDefinitionDescription = Manager of the initiator of the process
config.pageTitle = Configuration
config.pageDescription = Configuration of the process initiator-manager filter
connexionConfigPage.pageDescription = Choose here if you want to automatically assign the task to this actor
autoAssign.label = Assign task automatically
autoAssign.description = The task will be claimed automatically by the resolved user 
</code>

<p></p>

<h2><a id="Actor_filter_implementation"></a>Actor filter implementation</h2>

<p>An actor filter implementation consists of an XML resource file and a Java
class. You can create any number of implementations that correspond to a given definition. 
However, in a process there is a one-to-one relationship between the actor filter definition and the actor filter implementation.</p>

<h3>Actor filter implementation resource file</h3>

<p>The resource file defines:</p>
<ul><li>the id and version of the definition that is implemented</li>
  <li>the id and version of the implementation</li>
  <li>the set of dependencies required by the implementation. </li>
</ul><p>The resource file follows the schema defined in <span class="tt">http://documentation.bonitasoft.com/ns/connector/definition/6.0/connector-implementation-descriptor.xsd </span>.</p>

<p>The following example is the resource file of an implementation of the
initiator manager actor filter:</p>

<code type="xml">
<?xml version="1.0" encoding="UTF-8"?><connectorimplementation xmlns:implementation="http://www.bonitasoft.org/ns/connector/implementation/6.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><definitionid>initiator-manager</definitionid><definitionversion>1.0.0</definitionversion><implementationclassname>org.bonitasoft.userfilter.initiator.manager.ProcessinitiatorManagerUserFilter</implementationclassname><implementationid>initiator-manager-impl</implementationid><implementationversion>1.0.0</implementationversion><jardependencies><jardependency>bonita-userfilter-initiator-manager-impl-1.0.0-SNAPSHOT.jar</jardependency></jardependencies></connectorimplementation></code>

<h3>Actor filter implementation Java class</h3>

<p>The Java class must implement the <span class="tt">
org.bonitasoft.engine.filter.AbstractUserFilter</span>class and use the Engine
ExecutionContext. The following methods must be implemented:</p>
<ul><li><span class="tt">validateInputParameters</span> to
    check that the configuration of the actor filter is well defined</li>
  <li>filter to get a list of identifiers of all the users that correspond to a
    specified actor name</li>
  <li><span class="tt">shouldAutoAssignTaskIfSingleResult
    to assign the step to the user if filter returns one user</span></li>
</ul><p>For details of the APIs, the methods and related objects, see the  
<a href="/javadoc-71">Javadoc</a>.</p>

<h3>Actor filter example code</h3>

<p>The following code is an example of the initiator manager actor filter. </p>

<code type="java">
public class ProcessinitiatorManagerUserFilter extends AbstractUserFilter {

    @Override
    public void validateInputParameters() throws ConnectorValidationException {
    }

    @Override
    public List<long> filter(final String actorName) throws UserFilterException {
        try {
              final long processInstanceId = getExecutionContext().getParentProcessInstanceId();
              long processInitiator = getAPIAccessor().getProcessAPI().getProcessInstance(processInstanceId).getStartedBy();
              return Arrays.asList( getAPIAccessor().getIdentityAPI().getUser(processInitiator).getManagerUserId());
        } catch (final BonitaException e) {
            throw new UserFilterException(e);
        }
    }

    @Override
    public boolean shouldAutoAssignTaskIfSingleResult() {
        final Boolean autoAssignO = (Boolean) getInputParameter("autoAssign");
        return autoAssignO == null ? true : autoAssignO;
    }

} 
</long></code> 

<p></p>

<h2><a id="Testing_an_actor_filter"></a>Testing an actor filter</h2>

<p>There are three stages to testing an actor filter:</p>
<ol><li>Build the actor filter. If you are using Maven, create two projects, one
    for the definition and one for the implementation. Build the artifacts for
    import into Bonita BPM Studio, using the following command: 
    <p><span class="tt">mvn clean install</span></p>
    <p>This creates a zip file.</p>
  </li>
  <li>Import the actor filter into Bonita BPM Studio. From the
    <strong>Development</strong> menu, choose <strong>Actor filters</strong>,
    then choose <strong>Import...</strong>. Select the zip file to be
  imported.</li>
  <li>Test the actor filter in a process. Create a minimal process and add the actor
    filter to a step. Configure the process and run it from Bonita BPM Studio.
    Check the Engine log (available through the <strong>Help</strong> menu) for
    any error messages caused by the actor filter.</li>
</ol><p></p>

<h2><a id="Importing_an_Actor_filter"></a>Importing an actor filter into Bonita BPM Studio</h2>

<ol><li>Create a zip file that contains the files used by the definition and implementation.</li>
<li>In Bonita BPM Studio, go to the <strong>Development</strong> menu, <strong>Actor filters</strong>, <strong>Import actor filter...</strong>.</li>
<li>Upload the zip file.</li>
</ol><p>The imported actor filter is now available in the dialog for adding an actor filter.</p>

<p>It is also possible to export an actor filter using options in the <strong>Development</strong> menu. The actor is exported as a .zip file, which you can import into another
instance of Bonita BPM Studio.</p>

<p></p>


<h2><a id="L571"></a>Configuring and deploying a process with an actor filter </h2>

<p>When you configure a process that uses an actor filter in Bonita BPM Studio, you
specify the definition and implementation. You must also specify any
dependencies as process dependencies. After the actor filter has been specified
in the configuration, when you build the process for deployment referencing the
configuration, the actor filter code is included in the business archive.</p>

<p></p></div>
	</body></html>
